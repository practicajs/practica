<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://practica.dev/blog</id>
    <title>Practica.js Blog</title>
    <updated>2023-08-06T10:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://practica.dev/blog"/>
    <subtitle>Practica.js Blog</subtitle>
    <icon>https://practica.dev/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[A compilation of outstanding testing articles (with JavaScript)]]></title>
        <id>a-compilation-of-outstanding-testing-articles-with-javaScript</id>
        <link href="https://practica.dev/blog/a-compilation-of-outstanding-testing-articles-with-javaScript"/>
        <updated>2023-08-06T10:00:00.000Z</updated>
        <summary type="html"><![CDATA[What's special about this article?]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-special-about-this-article">What's special about this article?<a class="hash-link" href="#whats-special-about-this-article" title="Direct link to heading">â€‹</a></h2><p>As a testing consultant, I read tons of testing articles throughout the years. The majority is nice-to-read, casual pieces of content which not always worth your precious time. Once in a while, not very often, I landed on an article that was <em>shockingly good</em> and could genuinely improve your test writing skills. I've cherry-picked these outstanding articles for you, and added my abstract nearby. Half of these articles are related directly to JavaScript/Node.js, the second half covers ubiquitous testing concepts that are applicable in every language</p><p>Why did I find these articles to be outstanding? First, the writing quality is excellent. Second, they deal with the 'new world of testing', not the commonly known 'TDD-ish' stuff but rather modern concepts and tooling</p><p>Too busy to read them all? Search for articles that are decorated with a medal ğŸ…, these are a true masterpiece pieces of content that you never wanna miss</p><p><strong>Before we start:</strong> If you haven't heard, I launched my comprehensive Node.js testing course a week ago  (<a href="https://testjavascript.com/curriculum2/" target="_blank" rel="noopener noreferrer">curriculum here</a>). There are less than 48 hours left for the <a href="https://courses.testjavascript.com/p/node-js-javascript-testing-from-a-to-z" target="_blank" rel="noopener noreferrer">ğŸ special launch deal</a></p><p>Here they are, 10 outstanding testing articles:</p><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-1-selective-unit-testing--costs-and-benefits">ğŸ“„ 1. 'Selective Unit Testing â€“ Costs and Benefits'<a class="hash-link" href="#-1-selective-unit-testing--costs-and-benefits" title="Direct link to heading">â€‹</a></h2><p><strong>âœï¸ Author:</strong> Steve Sanderson</p><p><strong>ğŸ”– Abstract:</strong> We all found ourselves at least once in the ongoing and flammable discussion about 'units' vs 'integration'. This articles delve into a greater level of specificity and discuss WHEN unit test shine by considering the costs of writing these tests under <em>various scenarios</em>. Many treat their testing strategy as a static model - a testing technique they always write regardless of the context. "Always write unit tests against functions", "Write mostly integration tests" are a type of arguments often heard. Conversely, this article suggests that the attractiveness of unit tests should be evaluated based on the <em>costs and benefits per module</em>. The article classifies multiple scenarios where the net value of unit tests is high or low, for example:</p><blockquote><p>If your code is basically obvious â€“ so at a glance you can see exactly what it does â€“ then additional design and verification (e.g., through unit testing) yields extremely minimal benefit, if any</p></blockquote><p>The author also puts a 2x2 model to visualize when the attractiveness of unit tests is high or low</p><p><img loading="lazy" alt="When unit shines" src="/assets/images/selective-unit-tests-b5303f3a425ab038c9aede3d14214abc.png" width="453" height="328" class="img_ev3q"></p><p>Side note, not part of the article: Personally I (Yoni) always start with component tests, outside-in, cover first the high-level user flow details (a.k.a <a href="https://www.crispy-engineering.com/p/why-test-diamond-model-makes-sense" target="_blank" rel="noopener noreferrer">the testing diamond</a>). Then later once I have functions, I add unit tests based on their net value. This article helped me a lot in classifying and evaluating the benefits of units in various scenarios</p><p><strong>ğŸ‘“ Read time:</strong> 9 min (1850 words)</p><p><strong>ğŸ”— Link:</strong> <a href="https://blog.stevensanderson.com/2009/11/04/selective-unit-testing-costs-and-benefits/" target="_blank" rel="noopener noreferrer">https://blog.stevensanderson.com/2009/11/04/selective-unit-testing-costs-and-benefits/</a></p><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-2-testing-implementation-details-javascript-example">ğŸ“„ 2. 'Testing implementation details' (JavaScript example)<a class="hash-link" href="#-2-testing-implementation-details-javascript-example" title="Direct link to heading">â€‹</a></h2><p><strong>âœï¸ Author:</strong> Kent C Dodds</p><p><strong>ğŸ”– Abstract:</strong> The author outlines with a code example the unavoidable tragic faith of a tester who assert on implementation details. Put aside the effort in testing so many details, going this route always end with 'false positive' and 'false negative' that clouds the tests reliability. The article illustrate this with a frontend code example but the lesson takeaway is ubiquitous to any kind of testing</p><blockquote><p>"There are two distinct reasons that it's important to avoid testing implementation details. Tests which test implementation details: </p><ol><li>Can break when you refactor application code. <em>False negatives</em></li><li>May not fail when you break application code. <em>False positives</em>"</li></ol></blockquote><p>p.s. This author has another outstanding post about a modern testing strategy, checkout this one as well - <a href="https://kentcdodds.com/blog/write-tests" target="_blank" rel="noopener noreferrer">'Write tests. Not too many. Mostly integration'</a></p><p><strong>ğŸ‘“ Read time:</strong> 13 min (2600 words)</p><p><strong>ğŸ”— Link:</strong> <a href="https://kentcdodds.com/blog/testing-implementation-details" target="_blank" rel="noopener noreferrer">https://kentcdodds.com/blog/testing-implementation-details</a></p><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-3-testing-microservices-the-sane-way">ğŸ“„ 3. 'Testing Microservices, the sane way'<a class="hash-link" href="#-3-testing-microservices-the-sane-way" title="Direct link to heading">â€‹</a></h2><p>ğŸ… This is a masterpiece</p><p><strong>âœï¸ Author:</strong> Cindy Sridharan</p><p><strong>ğŸ”– Abstract:</strong> This one is the entire Microservices and distributed modern testing bible packed in a single long article that is also super engaging. I remember when came across it four years ago, winter time, I spent an hour everyday under my blanket before sleep with a smile is spread over my face. I clicked on every link, pause after every paragraph to think - a whole new world was opening in front of me. In fact, it was so fascinating that it made me want to specialize in this domain. Fast forward, years later, this is a major part of my work and I enjoy every moment</p><p>This paper starts by explaining why E2E, unit tests and explanatory QA will fall short in a distributed environment. Not only this, why any kind of coded test won't be enough and a rich toolbox of techniques is needed. It goes through a handful of modern testing techniques that are unfamiliar to most developers. One of its key parts deal with what should be the canonical developer's testing technique: the author advocates for "big unit tests" (i.e., component tests) as it strikes a great balance between developers comfort and realism</p><blockquote><p>I coined the term â€œstep-up testingâ€, the general idea being to test at one layer above whatâ€™s generally advocated for. Under this model, unit tests would look more like integration tests (by treating I/O as a part of the unit under test within a bounded context), integration testing would look more like testing against real production, and testing in production looks more like, well, monitoring and exploration. The restructured test pyramid (test funnel?) for distributed systems would look like the following:</p></blockquote><p><img loading="lazy" alt="When unit shines" src="/assets/images/spectrum-of-testing-16da74a9b2c05eee95923f75e09bc713.png" width="546" height="409" class="img_ev3q"></p><p>Beyond its main scope, whatever type of system you are dealing with - this article will broaden yours perspective on testing and expose you to many new ideas that are highly applicable</p><p><strong>ğŸ‘“ Read time:</strong> &gt; 2 hours (10,500 words with many links)</p><p><strong>ğŸ”— Link:</strong> <a href="https://copyconstruct.medium.com/testing-microservices-the-sane-way-9bb31d158c16" target="_blank" rel="noopener noreferrer">https://copyconstruct.medium.com/testing-microservices-the-sane-way-9bb31d158c16</a></p><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-4-how-to-unit-test-with-nodejs-javascript-examples-for-beginners">ğŸ“„ 4. 'How to Unit Test with Node.js?' (JavaScript examples, for beginners)<a class="hash-link" href="#-4-how-to-unit-test-with-nodejs-javascript-examples-for-beginners" title="Direct link to heading">â€‹</a></h2><p><strong>âœï¸ Author:</strong> Ryan Jones</p><p><strong>ğŸ”– Abstract:</strong> <em>One single recommendation for beginners:</em> Any other article on this list covers advanced testing. This article, and only this one, is meant for testing newbies who are looking to take their first practical steps in this world</p><p>This tutorial was chosen from a handful of other alternatives because it's well-written and also relatively comprehensive. It covers the first steps 'kata' that a beginner should learn first about: the test anatomy syntax, test runners CLI, assertions and asynchronous tests. Goes without words, this knowledge won't be sufficient for covering a real-world app with testing, but it gets you safely to the next phase. My personal advice: after reading this one, your next step is learning about <a href="https://www.testim.io/blog/sinon-js-tutorial/" target="_blank" rel="noopener noreferrer">test doubles (mocking)</a></p><p><strong>ğŸ‘“ Read time:</strong> 16 min (3000 words)</p><p><strong>ğŸ”— Link:</strong> <a href="https://medium.com/serverlessguru/how-to-unit-test-with-nodejs-76967019ba56" target="_blank" rel="noopener noreferrer">https://medium.com/serverlessguru/how-to-unit-test-with-nodejs-76967019ba56</a></p><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-5-unit-test-fetish">ğŸ“„ 5. 'Unit test fetish'<a class="hash-link" href="#-5-unit-test-fetish" title="Direct link to heading">â€‹</a></h2><p><strong>âœï¸ Author:</strong> Martin SÃºstrik</p><p><strong>ğŸ”– Abstract:</strong> The article opens with 'I hear that prople feel an uncontrollable urge to write unit tests nowaydays. If you are one of those affected, spare few minutes and consider these reasons for NOT writing unit tests'. Despite these words, the article is not against unit tests as a principle rather highlights when &amp; where unit tests fall short. In these cases, other techniques should be considered. Here is an example: Unit tests inherently have lower return on investment, the author comes with a sounding analogy for this: 'If you are painting a house, you want to start with a biggest brush at hand and spare the tiny brush for the end to deal with fine details. If you begin your QA work with unit tests, you are essentially trying to paint entire house using the finest chinese calligraphy brush...'</p><p><strong>ğŸ‘“ Read time:</strong> 5 min (1000 words)</p><p><strong>ğŸ”— Link:</strong> <a href="https://250bpm.com/blog:40/" target="_blank" rel="noopener noreferrer">https://250bpm.com/blog:40/</a></p><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-6-mocking-is-a-code-smell-javascript-examples">ğŸ“„ 6. 'Mocking is a Code Smell' (JavaScript examples)<a class="hash-link" href="#-6-mocking-is-a-code-smell-javascript-examples" title="Direct link to heading">â€‹</a></h2><p><strong>âœï¸ Author:</strong> Eric Elliott</p><p><strong>ğŸ”– Abstract:</strong> Most of the articles here belong more to the 'modern wave of testing', here is something more 'classic' and appealing to TDD lovers or just anyone with a need to write unit tests. This article is about HOW to reduce the number of mocking (test doubles) in your tests. Not only because mocking is an overhead in test writing, also because they hint that something might be wrong. In other words, mocking is not definitely wrong and must be fixed right away but <em>many</em> mocking are a sign of something not ideal. Consider a module that inherits from many others, or a chatty one that collaborates with a handful of other modules to do its job - testing and changing this structure is a burden:</p><blockquote><p>"Mocking is required when our decomposition strategy has failed"</p></blockquote><p>The author goes through a various of techniques to design more autonomous units like using pure functions by isolating side-effects from the rest of the program logic, using pub/sub, isolating I/O, composing units with patterns like monadic compositions, and some more</p><p>The overall article tone is balanced. In some parts, it encourages functional programming and techniques that are far from the mainstream - consider reading these few parts with a grain of salt</p><p><strong>ğŸ‘“ Read time:</strong> 32 min (6,300 words)</p><p><strong>ğŸ”— Link:</strong> <a href="https://medium.com/javascript-scene/mocking-is-a-code-smell-944a70c90a6a" target="_blank" rel="noopener noreferrer">https://medium.com/javascript-scene/mocking-is-a-code-smell-944a70c90a6a</a></p><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-7-why-good-developers-write-bad-unit-tests">ğŸ“„ 7. 'Why Good Developers Write Bad Unit Tests'<a class="hash-link" href="#-7-why-good-developers-write-bad-unit-tests" title="Direct link to heading">â€‹</a></h2><p>ğŸ… This is a masterpiece</p><p><strong>âœï¸ Author:</strong> Michael Lynch</p><p><strong>ğŸ”– Abstract:</strong> I love this one so much. The author exemplifies how <em>unexpectedly</em> it is sometimes the good developers with their great intentions who write bad tests:</p><blockquote><p>Too often, software developers approach unit testing with the same flawed thinking... They mechanically apply all the â€œrulesâ€ they learned in production code without examining whether theyâ€™re appropriate for tests. As a result, they build skyscrapers at the beach</p></blockquote><p>Concrete code examples show how the test readability deteriorates once we apply 'sky scrapper' thinking and how to keep it simple. In one part, he demonstrates how violating the DRY principle thoughtfully allows the reader to stay within the test while still keeping the code maintainable. This article alone, in 11 minutes, can greatly improve the tests of developers who tend to write sophisticated tests. If you have someone like this in your team, you now know what to do</p><p><strong>ğŸ‘“ Read time:</strong> 11 min (2,2000 words)</p><p><strong>ğŸ”— Link:</strong> <a href="https://mtlynch.io/good-developers-bad-tests/" target="_blank" rel="noopener noreferrer">https://mtlynch.io/good-developers-bad-tests/</a></p><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-8-an-overview-of-javascript-testing-in-2022-javascript-examples">ğŸ“„ 8. 'An Overview of JavaScript Testing in 2022' (JavaScript examples)<a class="hash-link" href="#-8-an-overview-of-javascript-testing-in-2022-javascript-examples" title="Direct link to heading">â€‹</a></h2><p><strong>âœï¸ Author:</strong> Vitali Zaidman</p><p><strong>ğŸ”– Abstract:</strong> This paper is unique here as it doesn't cover a single topic rather being a rundown of (almost) all JavaScript testing tools. This allows you to enrich the toolbox in your mind, and have more screwdrivers for more type of screws. For example, knowing that there are IDE extensions that shows coverage information right within the code might help you boost the tests adoption in the team, if needed. Knowing that there are solid, free, and open source visual regression tools might encourage you to dip your toes in this water, to name a few examples.</p><blockquote><p>"We reviewed the most trending testing strategies and tools in the web development community and hopefully made it easier for you to test your sites. In the end, the best decisions regarding application architecture today are made by understanding general patterns that are trending in the very active community of developers, and combining them with your own experience and the characteristics of your application."</p></blockquote><p> The author was also kind enough to leave pros/cons nearby most tools so the reader can quickly get a sense of how the various options stack with each other. The article covers categories like assertion libraries, test runners, code coverage tools, visual regression tools, E2E suits and more</p><p><strong>ğŸ‘“ Read time:</strong> 37 min (7,400 words)</p><p><strong>ğŸ”— Link:</strong> <a href="https://medium.com/welldone-software/an-overview-of-javascript-testing-7ce7298b9870" target="_blank" rel="noopener noreferrer">https://medium.com/welldone-software/an-overview-of-javascript-testing-7ce7298b9870</a></p><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-9-testing-in-production-the-safe-way">ğŸ“„ 9. Testing in Production, the safe way<a class="hash-link" href="#-9-testing-in-production-the-safe-way" title="Direct link to heading">â€‹</a></h2><p><strong>âœï¸ Author:</strong> Cindy Sridharan</p><p><strong>ğŸ”– Abstract:</strong> 'Testing in production' is a provocative term that sounds like a risky and careless approach of testing over production instead of verifying the delivery beforehand (yet another case of bad testing terminology). In practice, testing in production doesn't replace coding-time testing, it just add <em>additional</em> layer of confidence by <em>safely</em> testing in 3 more phases: deployment, release and post-release. This comprehensive article covers dozens of techniques, some are unusual like traffic shadowing, tap compare and more. More than anything else, it illustrates an holistic testing workflow, build confidence cumulatively from developer machine until the new version is serving users in production</p><blockquote><p>Iâ€™m more and more convinced that staging environments are like mocks - at best a pale imitation of the genuine article and the worst form of confirmation bias. </p></blockquote><blockquote><p>Itâ€™s still better than having nothing - but â€œworks in stagingâ€ is only one step better than â€œworks on my machineâ€.</p></blockquote><p><img loading="lazy" alt="Testing in production" src="/assets/images/the-3-phases-06497437466da49c00ce842bb19d7a6d.jpeg" width="680" height="480" class="img_ev3q"></p><p><strong>ğŸ‘“ Read time:</strong> 54 min (10,725 words)</p><p><strong>ğŸ”— Link:</strong> <a href="https://copyconstruct.medium.com/testing-in-production-the-safe-way-18ca102d0ef1" target="_blank" rel="noopener noreferrer">https://copyconstruct.medium.com/testing-in-production-the-safe-way-18ca102d0ef1</a></p><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-10-please-dont-mock-me-javascript-examples-from-jsconf">ğŸ“„ 10. 'Please don't mock me' (JavaScript examples, from JSConf)<a class="hash-link" href="#-10-please-dont-mock-me-javascript-examples-from-jsconf" title="Direct link to heading">â€‹</a></h2><p>ğŸ… This is a masterpiece</p><p><strong>âœï¸ Author:</strong> Justin Searls </p><p><strong>ğŸ”– Abstract:</strong> This fantastic YouTube deals with the Achilles heel of testing: where exactly to mock. The dilemma where to end the test scope, what should be mocked and what's not - is presumably the most strategic test design decision. Consider for example having module A which interacts with module B. If you isolate A by mocking B, A will always pass, even when B's interface has changed and A's code didn't follow. This makes A's tests highly stable but... production will fail in hours. In his talk Justin says:</p><blockquote><p>"A test that never fails is a bad test because it doesn't tell you anything. Design tests to fail"</p></blockquote><p>Then he goes and tackle many other interesting mocking crossroads, with beautiful visuals, tons of insights. Please don't miss this one</p><p><strong>ğŸ‘“ Read time:</strong> 39 min</p><p><strong>ğŸ”— Link:</strong> <a href="https://www.youtube.com/watch?v=x8sKpJwq6lY&amp;list=PL1CRgzydk3vzk5nMZNLTODfMartQQzInE&amp;index=148" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=x8sKpJwq6lY&amp;list=PL1CRgzydk3vzk5nMZNLTODfMartQQzInE&amp;index=148</a></p><br><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-shameless-plug-my-articles">ğŸ“„ Shameless plug: my articles<a class="hash-link" href="#-shameless-plug-my-articles" title="Direct link to heading">â€‹</a></h3><p>Here are a few articles that I wrote, obviously I don't 'recommend' my own craft, just checking modestly whether they appeal to you. Together, these articles gained 25,000 GitHub stars, maybe you'll find one of them them useful?</p><ul><li><a href="https://github.com/testjavascript/nodejs-integration-tests-best-practices" target="_blank" rel="noopener noreferrer">Node.js testing - beyond the basics</a></li><li><a href="https://github.com/goldbergyoni/javascript-testing-best-practices" target="_blank" rel="noopener noreferrer">50+ JavaScript testing best practices</a></li><li><a href="https://yonigoldberg.medium.com/fighting-javascript-tests-complexity-with-the-basic-principles-87b7622eac9a" target="_blank" rel="noopener noreferrer">Writing clean JavaScript tests</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-bonus-some-other-great-testing-content">ğŸ Bonus: Some other great testing content<a class="hash-link" href="#-bonus-some-other-great-testing-content" title="Direct link to heading">â€‹</a></h3><p>These articles are also great, some are highly popular:</p><ul><li><a href="https://www.youtube.com/watch?v=5pwv3cuo3Qk" target="_blank" rel="noopener noreferrer">Property-Based Testing for everyone</a></li><li><a href="https://www.hillelwayne.com/post/metamorphic-testing/" target="_blank" rel="noopener noreferrer">METAMORPHIC TESTING</a></li><li><a href="https://medium.com/@eugenkiss/lean-testing-or-why-unit-tests-are-worse-than-you-think-b6500139a009" target="_blank" rel="noopener noreferrer">Lean Testing or Why Unit Tests are Worse than You Think</a></li><li><a href="https://martinfowler.com/articles/microservice-testing/?utm_source=pocket_saves" target="_blank" rel="noopener noreferrer">Testing Strategies in a Microservice Architecture</a></li><li><a href="https://kentbeck.github.io/TestDesiderata/" target="_blank" rel="noopener noreferrer">Test Desiderata</a></li><li><a href="https://dhh.dk/2014/tdd-is-dead-long-live-testing.html" target="_blank" rel="noopener noreferrer">TDD is dead. Long live testing</a></li><li><a href="https://dhh.dk/2014/test-induced-design-damage.html" target="_blank" rel="noopener noreferrer">Test-induced-design-damage</a></li><li><a href="https://www.jamesshore.com/v2/projects/nullables/testing-without-mocks" target="_blank" rel="noopener noreferrer">testing-without-mocks</a></li><li><a href="https://blog.developer.adobe.com/testing-error-handling-in-node-js-567323397114" target="_blank" rel="noopener noreferrer">Testing Node.js error handling</a></li></ul><p>p.s. Last reminder, less than 48 hours left for my <a href="https://courses.testjavascript.com/p/node-js-javascript-testing-from-a-to-z" target="_blank" rel="noopener noreferrer">online course ğŸ special launch offer</a></p>]]></content>
        <author>
            <name>Yoni Goldberg</name>
            <uri>https://github.com/goldbergyoni</uri>
        </author>
        <category label="node.js" term="node.js"/>
        <category label="testing" term="testing"/>
        <category label="javascript" term="javascript"/>
        <category label="tdd" term="tdd"/>
        <category label="unit" term="unit"/>
        <category label="integration" term="integration"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Testing the dark scenarios of your Node.js application]]></title>
        <id>testing-the-dark-scenarios-of-your-nodejs-application</id>
        <link href="https://practica.dev/blog/testing-the-dark-scenarios-of-your-nodejs-application"/>
        <updated>2023-07-07T11:00:00.000Z</updated>
        <summary type="html"><![CDATA[Where the dead-bodies are covered]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="where-the-dead-bodies-are-covered">Where the dead-bodies are covered<a class="hash-link" href="#where-the-dead-bodies-are-covered" title="Direct link to heading">â€‹</a></h2><p>This post is about tests that are easy to write, 5-8 lines typically, they cover dark and dangerous corners of our applications, but are often overlooked</p><p>Some context first: How do we test a modern backend? With <a href="https://ritesh-kapoor.medium.com/testing-automation-what-are-pyramids-and-diamonds-67494fec7c55" target="_blank" rel="noopener noreferrer">the testing diamond</a>, of course, by putting the focus on component/integration tests that cover all the layers, including a real DB. With this approach, our tests 99% resemble the production and the user flows, while the development experience is almost as good as with unit tests. Sweet. If this topic is of interest, we've also written <a href="https://github.com/testjavascript/nodejs-integration-tests-best-practices" target="_blank" rel="noopener noreferrer">a guide with 50 best practices for integration tests in Node.js</a></p><p>But there is a pitfall: most developers write <em>only</em> semi-happy test cases that are focused on the core user flows. Like invalid inputs, CRUD operations, various application states, etc. This is indeed the bread and butter, a great start, but a whole area is left uncovered. For example, typical tests don't simulate an unhandled promise rejection that leads to process crash, nor do they simulate the webserver bootstrap phase that might fail and leave the process idle, or HTTP calls to external services that often end with timeouts and retries. They typically not covering the health and readiness route, nor the integrity of the OpenAPI to the actual routes schema, to name just a few examples. There are many dead bodies covered beyond business logic, things that sometimes are even beyond bugs but rather are concerned with application downtime</p><p><img loading="lazy" alt="The hidden corners" src="/assets/images/the-hidden-corners-44855c2e5d9184502e1dc72b07d53cef.png" width="900" height="521" class="img_ev3q"></p><p>Here are a handful of examples that might open your mind to a whole new class of risks and tests</p><p><strong>July 2023: My testing course was launched: I've just released a comprehensive testing course that I've been working on for two years. ğŸ It's now on sale, but only for the month of July. Check it out at <a href="https://testjavascript.com/" target="_blank" rel="noopener noreferrer">testjavascript.com</a></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-examples"><strong>Test Examples</strong><a class="hash-link" href="#test-examples" title="Direct link to heading">â€‹</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ï¸-the-zombie-process-test">ğŸ§Ÿâ€â™€ï¸ The zombie process test<a class="hash-link" href="#ï¸-the-zombie-process-test" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ‘‰What &amp; so what? -</strong> In all of your tests, you assume that the app has already started successfully, lacking a test against the initialization flow. This is a pity because this phase hides some potential catastrophic failures: First, initialization failures are frequent - many bad things can happen here, like a DB connection failure or a new version that crashes during deployment. For this reason, runtime platforms (like Kubernetes and others) encourage components to signal when they are ready (see <a href="https://komodor.com/learn/kubernetes-readiness-probes-a-practical-guide/#:~:text=A%20readiness%20probe%20allows%20Kubernetes,on%20deletion%20of%20a%20pod." target="_blank" rel="noopener noreferrer">readiness probe</a>). Errors at this stage also have a dramatic effect over the app health - if the initialization fails and the process stays alive, it becomes a 'zombie process'. In this scenario, the runtime platform won't realize that something went bad, forward traffic to it and avoid creating alternative instances. Besides exiting gracefully, you may want to consider logging, firing a metric, and adjusting your /readiness route. Does it work? only test can tell!</p><p><strong>ğŸ“ Code</strong></p><p><strong>Code under test, api.js:</strong></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// A common express server initialization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">startWebServer</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// A typical Express setup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      expressApp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">defineRoutes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expressApp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// a function that defines all routes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      expressApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">WEB_SERVER_PORT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">//log here, fire a metric, maybe even retry and finally:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>The test:</strong></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> api </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./entry-points/api'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// our api starter that exposes 'startWebServer' function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> sinon </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'sinon'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// a mocking library</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'When an error happens during the startup phase, then the process exits'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Arrange</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> processExitListener </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sinon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'exit'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ğŸ‘‡ Choose a function that is part of the initialization phase and make it fail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sinon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">routes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'defineRoutes'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">throws</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Cant initialize connection'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Act</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">startWebServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Assert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">processExitListener</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">called</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toBe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-the-observability-test">ğŸ‘€ The observability test<a class="hash-link" href="#-the-observability-test" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ‘‰What &amp; why -</strong> For many, testing error means checking the exception type or the API response. This leaves one of the most essential parts uncovered - making the error <strong>correctly observable</strong>. In plain words, ensuring that it's being logged correctly and exposed to the monitoring system. It might sound like an internal thing, implementation testing, but actually, it goes directly to a user. Yes, not the end-user, but rather another important one - the ops user who is on-call. What are the expectations of this user? At the very basic level, when a production issue arises, she must see detailed log entries, <em>including stack trace</em>, cause and other properties. This info can save the day when dealing with production incidents. On to of this, in many systems, monitoring is managed separately to conclude about the overall system state using cumulative heuristics (e.g., an increase in the number of errors over the last 3 hours). To support this monitoring needs, the code also must fire error metrics. Even tests that do try to cover these needs take a naive approach by checking that the logger function was called - but hey, does it include the right data? Some write better tests that check the error type that was passed to the logger, good enough? No! The ops user doesn't care about the JavaScript class names but the JSON data that is sent out. The following test focuses on the specific properties that are being made observable:</p><p><strong>ğŸ“ Code</strong></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'When exception is throw during request, Then logger reports the mandatory fields'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//Arrange</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> orderToAdd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">userId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">productId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'approved'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> metricsExporterDouble </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sinon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metricsExporter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'fireMetric'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sinon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">OrderRepository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'addOrder'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">rejects</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">AppError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'saving-failed'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Order could not be saved'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> loggerDouble </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sinon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'error'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//Act</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> axiosAPIClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/order'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> orderToAdd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//Assert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">loggerDouble</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toHaveBeenCalledWith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'saving-failed'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">stack</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> expect</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">any</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">String</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> expect</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">any</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">String</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metricsExporterDouble</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toHaveBeenCalledWith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'error'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">errorName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'example-error'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-the-unexpected-visitor-test---when-an-uncaught-exception-meets-our-code">ğŸ‘½ The 'unexpected visitor' test - when an uncaught exception meets our code<a class="hash-link" href="#-the-unexpected-visitor-test---when-an-uncaught-exception-meets-our-code" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ‘‰What &amp; why -</strong> A typical error flow test falsely assumes two conditions: A valid error object was thrown, and it was caught. Neither is guaranteed, let's focus on the 2nd assumption: it's common for certain errors to left uncaught. The error might get thrown before your framework error handler is ready, some npm libraries can throw surprisingly from different stacks using timer functions, or you just forget to set someEventEmitter.on('error', ...). To name a few examples. These errors will find their way to the global process.on('uncaughtException') handler, <strong>hopefully if your code subscribed</strong>. How do you simulate this scenario in a test? naively you may locate a code area that is not wrapped with try-catch and stub it to throw during the test. But here's a catch22: if you are familiar with such area - you are likely to fix it and ensure its errors are caught. What do we do then? we can bring to our benefit the fact the JavaScript is 'borderless', if some object can emit an event, we as its subscribers can make it emit this event ourselves, here's an example:</p><p>researches says that, rejection</p><p><strong>ğŸ“ Code</strong></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'When an unhandled exception is thrown, then process stays alive and the error is logged'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//Arrange</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> loggerDouble </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sinon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'error'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> processExitListener </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sinon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'exit'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> errorToThrow </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'An error that wont be caught ğŸ˜³'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//Act</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'uncaughtException'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> errorToThrow</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//ğŸ‘ˆ Where the magic is</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Assert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">processExitListener</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">called</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toBe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">loggerDouble</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toHaveBeenCalledWith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">errorToThrow</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-the-hidden-effect-test---when-the-code-should-not-mutate-at-all">ğŸ•µğŸ¼ The 'hidden effect' test - when the code should not mutate at all<a class="hash-link" href="#-the-hidden-effect-test---when-the-code-should-not-mutate-at-all" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ‘‰What &amp; so what -</strong> In common scenarios, the code under test should stop early like when the incoming payload is invalid or a user doesn't have sufficient credits to perform an operation. In these cases, no DB records should be mutated. Most tests out there in the wild settle with testing the HTTP response only - got back HTTP 400? great, the validation/authorization probably work. Or does it? The test trusts the code too much, a valid response doesn't guarantee that the code behind behaved as design. Maybe a new record was added although the user has no permissions? Clearly you need to test this, but how would you test that a record was NOT added? There are two options here: If the DB is purged before/after every test, than just try to perform an invalid operation and check that the DB is empty afterward. If you're not cleaning the DB often (like me, but that's another discussion), the payload must contain some unique and queryable value that you can query later and hope to get no records. This is how it looks like:</p><p><strong>ğŸ“ Code</strong></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'When adding an invalid order, then it returns 400 and NOT retrievable'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//Arrange</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> orderToAdd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">userId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">mode</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'draft'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">externalIdentifier</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uuid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//no existing record has this value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//Act</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> addingHTTPStatus </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> axiosAPIClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'/order'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orderToAdd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//Assert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> fetchingHTTPStatus </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> axiosAPIClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">/order/externalIdentifier/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">orderToAdd</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">externalIdentifier</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Trying to get the order that should have failed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> addingHTTPStatus</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fetchingHTTPStatus </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toMatchObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">addingHTTPStatus</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">fetchingHTTPStatus</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">404</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ğŸ‘† Check that no such record exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-the-overdoing-test---when-the-code-should-mutate-but-its-doing-too-much">ğŸ§¨ The 'overdoing' test - when the code should mutate but it's doing too much<a class="hash-link" href="#-the-overdoing-test---when-the-code-should-mutate-but-its-doing-too-much" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ‘‰What &amp; why -</strong> This is how a typical data-oriented test looks like: first you add some records, then approach the code under test, and finally assert what happens to these specific records. So far, so good. There is one caveat here though: since the test narrows it focus to specific records, it ignores whether other record were unnecessarily affected. This can be really bad, here's a short real-life story that happened to my customer: Some data access code changed and incorporated a bug that updates ALL the system users instead of just one. All test pass since they focused on a specific record which positively updated, they just ignored the others. How would you test and prevent? here is a nice trick that I was taught by my friend Gil Tayar: in the first phase of the test, besides the main records, add one or more 'control' records that should not get mutated during the test. Then, run the code under test, and besides the main assertion, check also that the control records were not affected:</p><p><strong>ğŸ“ Code</strong></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'When deleting an existing order, Then it should NOT be retrievable'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Arrange</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> orderToDelete </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">userId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">productId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> deletedOrder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> axiosAPIClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/order'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> orderToDelete</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// We will delete this soon</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> orderNotToBeDeleted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> orderToDelete</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> notDeletedOrder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> axiosAPIClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/order'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> orderNotToBeDeleted</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// We will not delete this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Act</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> axiosAPIClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">delete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">/order/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">deletedOrder</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Assert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> getDeletedOrderStatus </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> axiosAPIClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">/order/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">deletedOrder</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> getNotDeletedOrderStatus </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> axiosAPIClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">/order/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">notDeletedOrder</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">getNotDeletedOrderStatus</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toBe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">getDeletedOrderStatus</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toBe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">404</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-the-slow-collaborator-test---when-the-other-http-service-times-out">ğŸ•° The 'slow collaborator' test - when the other HTTP service times out<a class="hash-link" href="#-the-slow-collaborator-test---when-the-other-http-service-times-out" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ‘‰What &amp; why -</strong> When your code approaches other services/microservices via HTTP, savvy testers minimize end-to-end tests because these tests lean toward happy paths (it's harder to simulate scenarios). This mandates using some mocking tool to act like the remote service, for example, using tools like <a href="https://github.com/nock/nock" target="_blank" rel="noopener noreferrer">nock</a> or <a href="https://wiremock.org/" target="_blank" rel="noopener noreferrer">wiremock</a>. These tools are great, only some are using them naively and check mainly that calls outside were indeed made. What if the other service is not available <strong>in production</strong>, what if it is slower and times out occasionally (one of the biggest risks of Microservices)? While you can't wholly save this transaction, your code should do the best given the situation and retry, or at least log and return the right status to the caller. All the network mocking tools allow simulating delays, timeouts and other 'chaotic' scenarios. Question left is how to simulate slow response without having slow tests? You may use <a href="https://sinonjs.org/releases/latest/fake-timers/" target="_blank" rel="noopener noreferrer">fake timers</a> and trick the system into believing as few seconds passed in a single tick. If you're using <a href="https://github.com/nock/nock" target="_blank" rel="noopener noreferrer">nock</a>, it offers an interesting feature to simulate timeouts <strong>quickly</strong>: the .delay function simulates slow responses, then nock will realize immediately if the delay is higher than the HTTP client timeout and throw a timeout event immediately without waiting</p><p><strong>ğŸ“ Code</strong></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// In this example, our code accepts new Orders and while processing them approaches the Users Microservice</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'When users service times out, then return 503 (option 1 with fake timers)'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//Arrange</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> clock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sinon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">useFakeTimers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">HTTPCallTimeout</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Set a timeout for outgoing HTTP calls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">nock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">config</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">userServiceURL</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/user/</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/1'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> clock</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">tick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Reply delay is bigger than configured timeout ğŸ‘†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">reply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> loggerDouble </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sinon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'error'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> orderToAdd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">userId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">productId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">mode</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'approved'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//Act</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ğŸ‘‡try to add new order which should fail due to User service not available</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> axiosAPIClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/order'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> orderToAdd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//Assert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ğŸ‘‡At least our code does its best given this situation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">status</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toBe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">503</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">loggerDouble</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">lastCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">firstArg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toMatchObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'user-service-not-available'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">stack</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> expect</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">any</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">String</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> expect</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">any</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">String</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-the-poisoned-message-test---when-the-message-consumer-gets-an-invalid-payload-that-might-put-it-in-stagnation">ğŸ’Š The 'poisoned message' test - when the message consumer gets an invalid payload that might put it in stagnation<a class="hash-link" href="#-the-poisoned-message-test---when-the-message-consumer-gets-an-invalid-payload-that-might-put-it-in-stagnation" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ‘‰What &amp; so what -</strong> When testing flows that start or end in a queue, I bet you're going to bypass the message queue layer, where the code and libraries consume a queue, and you approach the logic layer directly. Yes, it makes things easier but leaves a class of uncovered risks. For example, what if the logic part throws an error or the message schema is invalid but the message queue consumer fails to translate this exception into a proper message queue action? For example, the consumer code might fail to reject the message or increment the number of attempts (depends on the type of queue that you're using). When this happens, the message will enter a loop where it always served again and again. Since this will apply to many messages, things can get really bad as the queue gets highly saturated. For this reason this syndrome was called the 'poisoned message'. To mitigate this risk, the tests' scope must include all the layers like how you probably do when testing against APIs. Unfortunately, this is not as easy as testing with DB because message queues are flaky, here is why</p><p>When testing with real queues things get curios and curiouser: tests from different process will steal messages from each other, purging queues is harder that you might think (e.g. <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-using-purge-queue.html" target="_blank" rel="noopener noreferrer">SQS demand 60 seconds</a> to purge queues), to name a few challenges that you won't find when dealing with real DB</p><p>Here is a strategy that works for many teams and holds a small compromise - use a fake in-memory message queue. By 'fake' I mean something simplistic that acts like a stub/spy and do nothing but telling when certain calls are made (e.g., consume, delete, publish). You might find reputable fakes/stubs for your own message queue like <a href="https://github.com/m-radzikowski/aws-sdk-client-mock" target="_blank" rel="noopener noreferrer">this one for SQS</a> and you can code one <strong>easily</strong> yourself. No worries, I'm not a favour of maintaining myself testing infrastructure, this proposed component is extremely simply and unlikely to surpass 50 lines of code (see example below). On top of this, whether using a real or fake queue, one more thing is needed: create a convenient interface that tells to the test when certain things happened like when a message was acknowledged/deleted or a new message was published. Without this, the test never knows when certain events happened and lean toward quirky techniques like polling. Having this setup, the test will be short, flat and you can easily simulate common message queue scenarios like out of order messages, batch reject, duplicated messages and in our example - the poisoned message scenario (using RabbitMQ):</p><p><strong>ğŸ“ Code</strong></p><ol><li>Create a fake message queue that does almost nothing but record calls, see full example here</li></ol><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">FakeMessageQueueProvider</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">EventEmitter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Implement here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">consume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">queueName</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Make your message queue client accept real or fake provider</li></ol><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MessageQueueClient</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">EventEmitter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Pass to it a fake or real message queue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">customMessageQueueProvider</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">consume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">queueName</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Simple implementation can be found here:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// https://github.com/testjavascript/nodejs-integration-tests-best-practices/blob/master/example-application/libraries/fake-message-queue-provider.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Expose a convenient function that tells when certain calls where made</li></ol><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MessageQueueClient</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">EventEmitter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">consume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">queueName</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ğŸ‘‡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">waitForEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eventName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'publish'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'consume'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'acknowledge'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'reject'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">howManyTimes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>The test is now short, flat and expressive ğŸ‘‡</li></ol><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">FakeMessageQueueProvider</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./libs/fake-message-queue-provider'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">MessageQueueClient</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./libs/message-queue-client'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> newOrderService </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./domain/newOrderService'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'When a poisoned message arrives, then it is being rejected back'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Arrange</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> messageWithInvalidSchema </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">nonExistingProperty</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'invalidâŒ'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> messageQueueClient </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">MessageQueueClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FakeMessageQueueProvider</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Subscribe to new messages and passing the handler function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  messageQueueClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">consume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'orders.new'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newOrderService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">addOrder</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Act</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> messageQueueClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'orders.new'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> messageWithInvalidSchema</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Now all the layers of the app will get stretched ğŸ‘†, including logic and message queue libraries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Assert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> messageQueueClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">waitFor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'reject'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">howManyTimes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ğŸ‘† This tells us that eventually our code asked the message queue client to reject this poisoned message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ğŸ“Full code example -</strong> <a href="https://github.com/testjavascript/nodejs-integration-tests-best-practices/blob/master/recipes/message-queue/fake-message-queue.test.js" target="_blank" rel="noopener noreferrer">is here</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-test-the-package-as-a-consumer">ğŸ“¦ Test the package as a consumer<a class="hash-link" href="#-test-the-package-as-a-consumer" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ‘‰What &amp; why -</strong> When publishing a library to npm, easily all your tests might pass BUT... the same functionality will fail over the end-user's computer. How come? tests are executed against the local developer files, but the end-user is only exposed to artifacts <em>that were built</em>. See the mismatch here? <em>after</em> running the tests, the package files are transpiled (I'm looking at you babel users), zipped and packed. If a single file is excluded due to .npmignore or a polyfill is not added correctly, the published code will lack mandatory files</p><p><strong>ğŸ“ Code</strong></p><p>Consider the following scenario, you're developing a library, and you wrote this code:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// index.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token exports operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./calculate.js'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// calculate.js ğŸ‘ˆ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">calculate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then some tests:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> calculate </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./index.js'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'should return 1'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">calculate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toBe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">âœ… </span><span class="token maybe-class-name">All</span><span class="token plain"> tests pass ğŸŠ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally configure the package.json:</p><div class="language-json5 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json5 codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "files": [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "index.js"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>See, 100% coverage, all tests pass locally and in the CI âœ…, it just won't work in production ğŸ‘¹. Why? because you forgot to include the <code>calculate.js</code> in the package.json <code>files</code> array ğŸ‘†</p><p>What can we do instead? we can test the library as <em>its end-users</em>. How? publish the package to a local registry like <a href="https://verdaccio.org/" target="_blank" rel="noopener noreferrer">verdaccio</a>, let the tests install and approach the <em>published</em> code. Sounds troublesome? judge yourself ğŸ‘‡</p><p><strong>ğŸ“ Code</strong></p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// global-setup.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 1. Setup the in-memory NPM registry, one function that's it! ğŸ”¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setupVerdaccio</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 2. Building our package </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">exec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'npm'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'run'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'build'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">cwd</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> packagePath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 3. Publish it to the in-memory registry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">exec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'npm'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'publish'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'--registry=http://localhost:4873'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">cwd</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> packagePath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 4. Installing it in the consumer directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">exec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'npm'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'install'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'my-package'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'--registry=http://localhost:4873'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">cwd</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> consumerPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Test file in the consumerPath</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 5. Test the package ğŸš€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"should succeed"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> fn1 </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">import</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'my-package'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">fn1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ğŸ“Full code example -</strong> <a href="https://github.com/rluvaton/e2e-verdaccio-example" target="_blank" rel="noopener noreferrer">is here</a></p><p>What else this technique can be useful for?</p><ul><li>Testing different version of peer dependency you support - let's say your package support react 16 to 18, you can now test that</li><li>You want to test ESM and CJS consumers</li><li>If you have CLI application you can test it like your users</li><li>Making sure all the voodoo magic in that babel file is working as expected</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-the-broken-contract-test---when-the-code-is-great-but-its-corresponding-openapi-docs-leads-to-a-production-bug">ğŸ— The 'broken contract' test - when the code is great but its corresponding OpenAPI docs leads to a production bug<a class="hash-link" href="#-the-broken-contract-test---when-the-code-is-great-but-its-corresponding-openapi-docs-leads-to-a-production-bug" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ‘‰What &amp; so what -</strong> Quite confidently I'm sure that almost no team test their OpenAPI correctness. "It's just documentation", "we generate it automatically based on code" are typical belief found for this reason. Let me show you how this auto generated documentation can be wrong and lead not only to frustration but also to a bug. In production.</p><p>Consider the following scenario, you're requested to return HTTP error status code if an order is duplicated but forget to update the OpenAPI specification with this new HTTP status response. While some framework can update the docs with new fields, none can realize which errors your code throws, this labour is always manual. On the other side of the line, the API client is doing everything just right, going by the spec that you published, adding orders with some duplication because the docs don't forbid doing so. Then, BOOM, production bug -&gt; the client crashes and shows an ugly unknown error message to the user. This type of failure is called the 'contract' problem when two parties interact, each has a code that works perfect, they just operate under different spec and assumptions. While there are fancy sophisticated and exhaustive solution to this challenge (e.g., <a href="https://pact.io" target="_blank" rel="noopener noreferrer">PACT</a>), there are also leaner approaches that gets you covered <em>easily and quickly</em> (at the price of covering less risks).</p><p>The following sweet technique is based on libraries (jest, mocha) that listen to all network responses, compare the payload against the OpenAPI document, and if any deviation is found - make the test fail with a descriptive error. With this new weapon in your toolbox and almost zero effort, another risk is ticked. It's a pity that these libs can't assert also against the incoming requests to tell you that your tests use the API wrong. One small caveat and an elegant solution: These libraries dictate putting an assertion statement in every test - expect(response).toSatisfyApiSpec(), a bit tedious and relies on human discipline. You can do better if your HTTP client supports plugin/hook/interceptor by putting this assertion in a single place that will apply in all the tests:</p><p><strong>ğŸ“ Code</strong></p><p><strong>Code under test, an API throw a new error status</strong></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">doesOrderCouponAlreadyExist</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">AppError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'duplicated-coupon'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">httpStatus</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">409</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The OpenAPI doesn't document HTTP status '409', no framework knows to update the OpenAPI doc based on thrown exceptions</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">"responses"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"200"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"successful"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"400"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Invalid ID"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">"content"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token comment" style="color:#999988;font-style:italic">// No 409 in this listğŸ˜²ğŸ‘ˆ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>The test code</strong></p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> jestOpenAPI </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'jest-openapi'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">jestOpenAPI</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'../openapi.json'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'When an order with duplicated coupon is added , then 409 error should get returned'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Arrange</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> orderToAdd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">userId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">productId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">couponId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uuid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> axiosAPIClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/order'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> orderToAdd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Act</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// We're adding the same coupon twice ğŸ‘‡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> receivedResponse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> axios</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/order'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> orderToAdd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Assert;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">receivedResponse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">status</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toBe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">409</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toSatisfyApiSpec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// This ğŸ‘† will throw if the API response, body or status, is different that was it stated in the OpenAPI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Trick: If your HTTP client supports any kind of plugin/hook/interceptor, put the following code in 'beforeAll'. This covers all the tests against OpenAPI mismatches</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">beforeAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  axios</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">interceptors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toSatisfyApiSpec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// With this ğŸ‘†, add nothing to the tests - each will fail if the response deviates from the docs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="even-more-ideas">Even more ideas<a class="hash-link" href="#even-more-ideas" title="Direct link to heading">â€‹</a></h2><ul><li>Test readiness and health routes</li><li>Test message queue connection failures</li><li>Test JWT and JWKS failures</li><li>Test security-related things like CSRF tokens</li><li>Test your HTTP client retry mechanism (very easy with nock)</li><li>Test that the DB migration succeed and the new code can work with old records format</li><li>Test DB connection disconnects</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="its-not-just-ideas-it-a-whole-new-mindset">It's not just ideas, it a whole new mindset<a class="hash-link" href="#its-not-just-ideas-it-a-whole-new-mindset" title="Direct link to heading">â€‹</a></h2><p>The examples above were not meant only to be a checklist of 'don't forget' test cases, but rather a fresh mindset on what tests could cover for you. Modern tests are not just about functions, or user flows, but any risk that might visit your production. This is doable only with component/integration tests but never with unit or end-to-end tests. Why? Because unlike unit you need all the parts to play together (e.g., the DB migration file, with the DAL layer and the error handler all together). Unlike E2E, you have the power to simulate in-process scenarios that demand some tweaking and mocking. Component tests allow you to include many production moving parts early on your machine. I like calling this 'production-oriented development'</p><p><strong>My new online testing course -</strong> If you're intrigued with beyond the basics testing patterns, <a href="https://testjavascript.com" target="_blank" rel="noopener noreferrer">consider my online course which was just launched and is ğŸ on sale for 30 days (July 2023)</a></p>]]></content>
        <author>
            <name>Yoni Goldberg</name>
            <uri>https://github.com/goldbergyoni</uri>
        </author>
        <author>
            <name>Raz Luvaton</name>
            <uri>https://github.com/rluvaton</uri>
        </author>
        <category label="node.js" term="node.js"/>
        <category label="testing" term="testing"/>
        <category label="component-test" term="component-test"/>
        <category label="fastify" term="fastify"/>
        <category label="unit-test" term="unit-test"/>
        <category label="integration" term="integration"/>
        <category label="nock" term="nock"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Practica v0.0.6 is alive]]></title>
        <id>practica-v0.0.6-is-alive</id>
        <link href="https://practica.dev/blog/practica-v0.0.6-is-alive"/>
        <updated>2022-12-10T10:00:00.000Z</updated>
        <summary type="html"><![CDATA[Where is our focus now?]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="where-is-our-focus-now">Where is our focus now?<a class="hash-link" href="#where-is-our-focus-now" title="Direct link to heading">â€‹</a></h2><p>We work in two parallel paths: enriching the supported best practices to make the code more production ready and at the same time enhance the existing code based off the community feedback</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-new">What's new?<a class="hash-link" href="#whats-new" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-level-store">Request-level store<a class="hash-link" href="#request-level-store" title="Direct link to heading">â€‹</a></h3><p>Every request now has its own store of variables, you may assign information on the request-level so every code which was called from this specific request has access to these variables. For example, for storing the user permissions. One special variable that is stored is 'request-id' which is a unique UUID per request (also called correlation-id). The logger automatically will emit this to every log entry. We use the built-in <a href="https://nodejs.org/api/async_context.html" target="_blank" rel="noopener noreferrer">AsyncLocal</a> for this task</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hardened-dockerfile">Hardened .dockerfile<a class="hash-link" href="#hardened-dockerfile" title="Direct link to heading">â€‹</a></h3><p>Although a Dockerfile may contain 10 lines, it easy and common to include 20 mistakes in these short artifact. For example, commonly npmrc secrets are leaked, usage of vulnerable base image and other typical mistakes. Our .Dockerfile follows the best practices from <a href="https://snyk.io/blog/10-best-practices-to-containerize-nodejs-web-applications-with-docker/" target="_blank" rel="noopener noreferrer">this article</a> and already apply 90% of the guidelines</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-orm-option-prisma">Additional ORM option: Prisma<a class="hash-link" href="#additional-orm-option-prisma" title="Direct link to heading">â€‹</a></h3><p>Prisma is an emerging ORM with great type safe support and awesome DX. We will keep Sequelize as our default ORM while Prisma will be an optional choice using the flag: --orm=prisma</p><p>Why did we add it to our tools basket and why Sequelize is still the default? We summarized all of our thoughts and data in this <a href="https://practica.dev/blog/is-prisma-better-than-your-traditional-orm/" target="_blank" rel="noopener noreferrer">blog post</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="many-small-enhancements">Many small enhancements<a class="hash-link" href="#many-small-enhancements" title="Direct link to heading">â€‹</a></h3><p>More than 10 PR were merged with CLI experience improvements, bug fixes, code patterns enhancements and more</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="where-do-i-start">Where do I start?<a class="hash-link" href="#where-do-i-start" title="Direct link to heading">â€‹</a></h2><p>Definitely follow the <a href="https://practica.dev/the-basics/getting-started-quickly" target="_blank" rel="noopener noreferrer">getting started guide first</a> and then read the guide <a href="https://practica.dev/the-basics/coding-with-practica" target="_blank" rel="noopener noreferrer">coding with practica</a> to realize its full power and genuine value. We will be thankful to receive your feedback</p>]]></content>
        <author>
            <name>Yoni Goldberg</name>
            <uri>https://github.com/goldbergyoni</uri>
        </author>
        <author>
            <name>Raz Luvaton</name>
            <uri>https://github.com/rluvaton</uri>
        </author>
        <author>
            <name>Daniel Gluskin</name>
            <uri>https://github.com/DanielGluskin</uri>
        </author>
        <author>
            <name>Michael Salomon</name>
            <uri>https://github.com/mikicho</uri>
        </author>
        <category label="node.js" term="node.js"/>
        <category label="express" term="express"/>
        <category label="practica" term="practica"/>
        <category label="prisma" term="prisma"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Is Prisma better than your 'traditional' ORM?]]></title>
        <id>is-prisma-better-than-your-traditional-orm</id>
        <link href="https://practica.dev/blog/is-prisma-better-than-your-traditional-orm"/>
        <updated>2022-12-07T11:00:00.000Z</updated>
        <summary type="html"><![CDATA[Intro - Why discuss yet another ORM (or the man who had a stain on his fancy suite)?]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="intro---why-discuss-yet-another-orm-or-the-man-who-had-a-stain-on-his-fancy-suite">Intro - Why discuss yet another ORM (or the man who had a stain on his fancy suite)?<a class="hash-link" href="#intro---why-discuss-yet-another-orm-or-the-man-who-had-a-stain-on-his-fancy-suite" title="Direct link to heading">â€‹</a></h2><p><em>Betteridge's law of headlines suggests that a 'headline that ends in a question mark can be answered by the word NO'. Will this article follow this rule?</em></p><p>Imagine an elegant businessman (or woman) walking into a building, wearing a fancy tuxedo and a luxury watch wrapped around his palm. He smiles and waves all over to say hello while people around are starring admirably. You get a little closer, then shockingly, while standing nearby it's hard ignore a bold a dark stain over his white shirt. What a dissonance, suddenly all of that glamour is stained</p><p><img loading="lazy" alt="Suite with stain" src="/assets/images/suite-4d046fac9ca9db57eafa55c4a7eac116.png" width="652" height="489" class="img_ev3q"></p><p> Like this businessman, Node is highly capable and popular, and yet, in certain areas, its offering basket is stained with inferior offerings. One of these areas is the ORM space, "I wish we had something like (Java) hibernate or (.NET) Entity Framework" are common words being heard by Node developers. What about existing mature ORMs like TypeORM and Sequelize? We owe so much to these maintainers, and yet, the produced developer experience, the level of maintenance - just don't feel delightful, some may say even mediocre. At least so I believed <em>before</em> writing this article...</p><p>From time to time, a shiny new ORM is launched, and there is hope. Then soon it's realized that these new emerging projects are more of the same, if they survive. Until one day, Prisma ORM arrived surrounded with glamour: It's gaining tons of attention all over, producing fantastic content, being used by respectful frameworks and... raised 40,000,000$ (40 million) to build the next generation ORM - Is it the 'Ferrari' ORM we've been waiting for? Is it a game changer? If you're are the 'no ORM for me' type, will this one make you convert your religion?</p><p>In <a href="https://github.com/practicajs/practica" target="_blank" rel="noopener noreferrer">Practica.js</a> (the Node.js starter based off <a href="https://github.com/goldbergyoni/nodebestpractices" target="_blank" rel="noopener noreferrer">Node.js best practices with 83,000 stars</a>) we aim to make the best decisions for our users, the Prisma hype made us stop by for a second, evaluate its unique offering and conclude whether we should upgrade our toolbox?</p><p>This article is certainly not an 'ORM 101' but rather a spotlight on specific dimensions in which Prisma aims to shine or struggle. It's compared against the two most popular Node.js ORM - TypeORM and Sequelize. Why not others? Why other promising contenders like MikroORM weren't covered? Just because they are not as popular yet ana maturity is a critical trait of ORMs</p><p>Ready to explore how good Prisma is and whether you should throw away your current tools?</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="toc">TOC<a class="hash-link" href="#toc" title="Direct link to heading">â€‹</a></h2><ol><li>Prisma basics in 3 minutes</li><li>Things that are mostly the same</li><li>Differentiation</li><li>Closing</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prisma-basics-in-3-minutes">Prisma basics in 3 minutes<a class="hash-link" href="#prisma-basics-in-3-minutes" title="Direct link to heading">â€‹</a></h2><p>Just before delving into the strategic differences, for the benefit of those unfamiliar with Prisma - here is a quick 'hello-world' workflow with Prisma ORM. If you're already familiar with it - skipping to the next section sounds sensible. Simply put, Prisma dictates 3 key steps to get our ORM code working:</p><p><strong>A. Define a model -</strong> Unlike almost any other ORM, Prisma brings a unique language (DSL) for modeling the database-to-code mapping. This proprietary syntax aims to express these models with minimum clutter (i.e., TypeScript generics and verbose code). Worried about having intellisense and validation? A well-crafted vscode extension gets you covered. In the following example, the prisma.schema file describes a DB with an Order table that has a one-to-many relation with a Country table:</p><div class="language-prisma codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-prisma codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// prisma.schema file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model Order {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id                 Int      @id @default(autoincrement())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  userId             Int?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  paymentTermsInDays Int?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  deliveryAddress    String? @db.VarChar(255)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  country            Country  @relation(fields: [countryId], references: [id])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  countryId          Int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model Country {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id    Int     @id @default(autoincrement())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name  String @db.VarChar(255)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Order Order[]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>B. Generate the client code -</strong> Another unusual technique: to get the ORM code ready, one must invoke Prisma's CLI and ask for it: </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx prisma generate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Alternatively, if you wish to have your DB ready and the code generated with one command, just fire:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx prisma migrate deploy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will generate migration files that you can execute later in production and also the ORM client code</p><p>This will generate migration files that you can execute later in production and the TypeScript ORM code based on the model. The generated code location is defaulted under '<!-- -->[root]<!-- -->/NODE_MODULES/.prisma/client'. Every time the model changes, the code must get re-generated again. While most ORMs name this code 'repository' or 'entity' or 'active record', interestingly, Prisma calls it a 'client'. This shows part of its unique philosophy, which we will explore later</p><p><strong>C. All good, use the client to interact with the DB -</strong> The generated client has a rich set of functions and types for your DB interactions. Just import the ORM/client code and use it:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">PrismaClient</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'.prisma/client'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> prisma </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">PrismaClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// A query example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> prisma</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">findMany</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">where</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">paymentTermsInDays</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">orderBy</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'asc'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Use the same client for insertion, deletion, updates, etc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That's the nuts and bolts of Prisma. Is it different and better?</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-the-same">What is the same?<a class="hash-link" href="#what-is-the-same" title="Direct link to heading">â€‹</a></h2><p>When comparing options, before outlining differences, it's useful to state what is actually similar among these products. Here is a partial list of features that both TypeORM, Sequelize and Prisma support</p><ul><li>Casual queries with sorting, filtering, distinct, group by, 'upsert' (update or create),etc</li><li>Raw queries</li><li>Full text search</li><li>Association/relations of any type (e.g., many to many, self-relation, etc)</li><li>Aggregation queries</li><li>Pagination</li><li>CLI</li><li>Transactions</li><li>Migration &amp; seeding</li><li>Hooks/events (called middleware in Prisma)</li><li>Connection pool</li><li>Based on various community benchmarks, no dramatic performance differences</li><li>All have huge amount of stars and downloads</li></ul><p>Overall, I found TypeORM and Sequelize to be a little more feature rich. For example, the following features are not supported only in Prisma: GIS queries, DB-level custom constraints, DB replication, soft delete, caching, exclude queries and some more</p><p>With that, shall we focus on what really set them apart and make a difference</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-fundamentally-different">What is fundamentally different?<a class="hash-link" href="#what-is-fundamentally-different" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-type-safety-across-the-board">1. Type safety across the board<a class="hash-link" href="#1-type-safety-across-the-board" title="Direct link to heading">â€‹</a></h3><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> ORM's life is not easier since the TypeScript rise, to say the least. The need to support typed models/queries/etc yields a lot of developers sweat. Sequelize, for example, struggles to stabilize a TypeScript interface and, by now offers 3 different syntaxes + one external library (<a href="https://github.com/sequelize/sequelize-typescript" target="_blank" rel="noopener noreferrer">sequelize-typescript</a>) that offers yet another style. Look at the syntax below, this feels like an afterthought - a library that was not built for TypeScript and now tries to squeeze it in somehow. Despite the major investment, both Sequelize and TypeORM offer only partial type safety. Simple queries do return typed objects, but other common corner cases like attributes/projections leave you with brittle strings. Here are a few examples:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Sequelize pesky TypeScript interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type </span><span class="token maybe-class-name">OrderAttributes</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">price</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// other attributes...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type </span><span class="token maybe-class-name">OrderCreationAttributes</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Optional</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">OrderAttributes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'id'</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//ğŸ˜¯ Isn't this a weird syntax?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">Model</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">InferAttributes</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Order</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">InferCreationAttributes</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Order</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  declare id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">CreationOptional</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  declare price</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Sequelize loose query types</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getOrderModel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">findAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">where</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">noneExistingField</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'noneExistingValue'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//ğŸ‘ TypeScript will warn here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">attributes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'none-existing-field'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'another-imaginary-column'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// No errors here although these columns do not exist</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">include</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'no-such-table'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//ğŸ˜¯ no errors here although this table doesn't exist</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getCountryModel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">findByPk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'price'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//ğŸ˜¯ No errors here although the price column is not a primary key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// TypeORM loose query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">ordersOnSales</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Post</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> orderRepository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">where</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">onSale</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//ğŸ‘ TypeScript will warn here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">select</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'id'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'price'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ordersOnSales</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">userId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//ğŸ˜¯ No errors here although the 'userId' column is not part of the returned object</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Isn't it ironic that a library called <strong>Type</strong>ORM base its queries on strings?</p><p><strong>ğŸ¤” How Prisma is different:</strong> It takes a totally different approach by generating per-project client code that is fully typed. This client embodies types for everything: every query, relations, sub-queries, everything (except migrations). While other ORMs struggles to infer types from discrete models (including associations that are declared in other files), Prisma's offline code generation is easier: It can look through the entire DB relations, use custom generation code and build an almost perfect TypeScript experience. Why 'almost' perfect? for some reason, Prisma advocates using plain SQL for migrations, which might result in a discrepancy between the code models and the DB schema. Other than that, this is how Prisma's client brings end to end type safety:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> prisma</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">findMany</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">where</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">noneExistingField</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//ğŸ‘ TypeScript error here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">select</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">noneExistingRelation</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//ğŸ‘ TypeScript error here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">select</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">noneExistingField</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//ğŸ‘ TypeScript error here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> prisma</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">findUnique</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">where</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">price</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//ğŸ‘ TypeScript error here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ğŸ“Š How important:</strong> TypeScript support across the board is valuable for DX mostly. Luckily, we have another safety net: The project testing. Since tests are mandatory, having build-time type verification is important but not a life saver</p><p><img loading="lazy" alt="Medium importance" src="data:image/png;base64,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" width="200" height="52" class="img_ev3q"></p><p><strong>ğŸ† Is Prisma doing better?:</strong> Definitely</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-make-you-forget-sql">2. Make you forget SQL<a class="hash-link" href="#2-make-you-forget-sql" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> Many avoid ORMs while preferring to interact with the DB using lower-level techniques. One of their arguments is against the efficiency of ORMs: Since the generated queries are not visible immediately to the developers, wasteful queries might get executed unknowingly. While all ORMs provide syntactic sugar over SQL, there are subtle differences in the level of abstraction. The more the ORM syntax resembles SQL, the more likely the developers will understand their own actions</p><p>For example, TypeORM's query builder looks like SQL broken into convenient functions</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createQueryBuilder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'order'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">leftJoinAndSelect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">'order.userId'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">'order.productId'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">'country.name'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">'country.id'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getMany</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A developer who read this code ğŸ‘† is likely to infer that a <em>join</em> query between two tables will get executed</p><p><strong>ğŸ¤” How Prisma is different:</strong> Prisma's mission statement is to simplify DB work, the following statement is taken from their homepage:</p><p>"We designed its API to be intuitive, both for SQL veterans and <em>developers brand new to databases</em>"</p><p>Being ambitious to appeal also to database layman, Prisma builds a syntax with a little bit higher abstraction, for example:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> prisma</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">findMany</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">select</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">userId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">productId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">country</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">select</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>No join is reminded here also it fetches records from two related tables (order, and country). Could you guess what SQL is being produced here? how many queries? One right, a simple join? Surprise,  actually, two queries are made. Prisma fires one query per-table here, as the join logic happens on the ORM client side (not inside the DB). But why?? in some cases, mostly where there is a lot of repetition in the DB cartesian join, querying each side of the relation is more efficient. But in other cases, it's not. Prisma arbitrarily chose what they believe will perform better in <em>most</em> cases. I checked, in my case it's <em>slower</em> than doing a one-join query on the DB side. As a developer, I would miss this deficiency due to the high-level syntax (no join is mentioned). My point is, Prisma sweet and simple syntax might be a  bless for developer who are brand new to databases and aim to achieve a working solution in a short time. For the longer term, having full awareness of the DB interactions is helpful, other ORMs encourage this awareness a little better</p><p><strong>ğŸ“Š How important:</strong> Any ORM will hide SQL details from their users - without developer's awareness no ORM will save the day</p><p><img loading="lazy" alt="Medium importance" src="data:image/png;base64,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" width="200" height="52" class="img_ev3q"></p><p><strong>ğŸ† Is Prisma doing better?:</strong> Not necessarily</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-performance">3. Performance<a class="hash-link" href="#3-performance" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> Speak to an ORM antagonist and you'll hear a common sensible argument: ORMs are much slower than a 'raw' approach. To an extent, this is a legit observation as <a href="https://welingtonfidelis.medium.com/pg-driver-vs-knex-js-vs-sequelize-vs-typeorm-f9ed53e9f802" target="_blank" rel="noopener noreferrer">most comparisons</a> will show none-negligible differences between raw/query-builder and ORM.</p><p><img loading="lazy" alt="raw is faster d" src="/assets/images/pg-driver-is-faster-88ee7217dd06fff1cc35ee2e8ccc3736.png" width="756" height="510" class="img_ev3q">
<em>Example: a direct insert against the PG driver is much shorter <a href="https://welingtonfidelis.medium.com/pg-driver-vs-knex-js-vs-sequelize-vs-typeorm-f9ed53e9f802" target="_blank" rel="noopener noreferrer">Source</a></em> </p><p> It should also be noted that these benchmarks don't tell the entire story - on top of raw queries, every solution must build a mapper layer that maps the raw data to JS objects, nest the results, cast types, and more. This work is included within every ORM but not shown in benchmarks for the raw option. In reality, every team which doesn't use ORM would have to build their own small "ORM", including a mapper, which will also impact performance</p><p><strong>ğŸ¤” How Prisma is different:</strong> It was my hope to see a magic here, eating the ORM cake without counting the calories, seeing Prisma achieving an almost 'raw' query speed. I had some good and logical reasons for this hope: Prisma uses a DB client built with Rust. Theoretically, it could serialize to and nest objects faster (in reality, this happens on the JS side). It was also built from the ground up and could build on the knowledge pilled in ORM space for years. Also, since it returns POJOs only (see bullet 'No Active Record here!') - no time should be spent on decorating objects with ORM fields</p><p>You already got it, this hope was not fulfilled. Going with every community benchmark (<a href="https://dev.to/josethz00/benchmark-prisma-vs-typeorm-3873" target="_blank" rel="noopener noreferrer">one</a>, <a href="https://github.com/edgedb/imdbench" target="_blank" rel="noopener noreferrer">two</a>, <a href="https://deepkit.io/library" target="_blank" rel="noopener noreferrer">three</a>), Prisma at best is not faster than the average ORM. What is the reason? I can't tell exactly but it might be due the complicated system that must support Go, future languages, MongoDB and other non-relational DBs</p><p><img loading="lazy" alt="Prisma is not faster" src="/assets/images/throughput-benchmark-91b84b17d860e3769a11be3835d6961a.png" width="1043" height="469" class="img_ev3q">
<em>Example: Prisma is not faster than others. It should be noted that in other benchmarks Prisma scores higher and shows an 'average' performance <a href="https://github.com/edgedb/imdbench" target="_blank" rel="noopener noreferrer">Source</a></em></p><p><strong>ğŸ“Š How important:</strong> It's expected from ORM users to live peacefully with inferior performance, for many systems it won't make a great deal. With that, 10%-30% performance differences between various ORMs are not a key factor</p><p><img loading="lazy" alt="Medium importance" src="data:image/png;base64,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" width="200" height="52" class="img_ev3q"></p><p><strong>ğŸ† Is Prisma doing better?:</strong> No</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-no-active-records-here">4. No active records here!<a class="hash-link" href="#4-no-active-records-here" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> Node in its early days was heavily inspired by Ruby (e.g., testing "describe"), many great patterns were embraced, <a href="https://en.wikipedia.org/wiki/Active_record_pattern" target="_blank" rel="noopener noreferrer">Active Record</a> is not among the successful ones. What is this pattern about in a nutshell? say you deal with Orders in your system, with Active Record an Order object/class will hold both the entity properties, possible also some of the logic functions and also CRUD functions. Many find this pattern to be awful, why? ideally, when coding some logic/flow, one should not keep her mind busy with side effects and DB narratives. It also might be that accessing some property unconsciously invokes a heavy DB call (i.e., lazy loading). If not enough, in case of heavy logic, unit tests might be in order (i.e., read <a href="https://blog.stevensanderson.com/2009/11/04/selective-unit-testing-costs-and-benefits/" target="_blank" rel="noopener noreferrer">'selective unit tests'</a>) - it's going to be much harder to write unit tests against code that interacts with the DB. In fact, all of the respectable and popular architecture (e.g., DDD, clean, 3-tiers, etc) advocate to 'isolate the domain', separate the core/logic of the system from the surrounding technologies. With all of that said, both TypeORM and Sequelize support the Active Record pattern which is displayed in many examples within their documentation. Both also support other better patterns like the data mapper (see below), but they still open the door for doubtful patterns</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// TypeORM active records ğŸ˜Ÿ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:#d73a49">Entity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">BaseEntity</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function maybe-class-name" style="color:#d73a49">PrimaryGeneratedColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function maybe-class-name" style="color:#d73a49">Column</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">price</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function maybe-class-name" style="color:#d73a49">ManyToOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">Product</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">product</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> product</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">order</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">products</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Product</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Other columns here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">updateOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter literal-property property" style="color:#36acaa">orderToUpdate</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Order</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">orderToUpdate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">price</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// some logic here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orderToUpdate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"approval"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orderToUpdate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">save</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orderToUpdate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">products</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">products</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orderToUpdate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">usedConnection</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ğŸ¤” How Prisma is different:</strong> The better alternative is the data mapper pattern. It acts as a bridge, an adapter, between simple object notations (domain objects with properties) to the DB language, typically SQL. Call it with a plain JS object, POJO, get it saved in the DB. Simple. It won't add functions to the result objects or do anything beyond returning pure data, no surprising side effects. In its purest sense, this is a DB-related utility and completely detached from the business logic. While both Sequelize and TypeORM support this, Prisma offers <em>only</em> this style - no room for mistakes.</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Prisma approach with a data mapper  ğŸ‘</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// This was generated automatically by Prisma</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type </span><span class="token maybe-class-name">Order</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">price</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">products</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Product</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Other columns here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">updateOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter literal-property property" style="color:#36acaa">orderToUpdate</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Order</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">orderToUpdate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">price</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orderToUpdate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"approval"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prisma</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">order</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">where</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> orderToUpdate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> orderToUpdate </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Side effect ğŸ‘†, but an explicit one. The thoughtful coder will move this to another function. Since it's happening outside, mocking is possible ğŸ‘</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    products</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">products</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// No lazy loading, the data is already here ğŸ‘</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> In <a href="https://github.com/practicajs/practica" target="_blank" rel="noopener noreferrer">Practica.js</a> we take it one step further and put the prisma models within the "DAL" layer and wrap it with the <a href="https://learn.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design" target="_blank" rel="noopener noreferrer">repository pattern</a>. You may glimpse <a href="https://github.com/practicajs/practica/blob/21ff12ba19cceed9a3735c09d48184b5beb5c410/src/code-templates/services/order-service/domain/new-order-use-case.ts#L21" target="_blank" rel="noopener noreferrer">into the code here</a>, this is the business flow that calls the DAL layer</p><p><strong>ğŸ“Š How important:</strong> On the one hand, this is a key architectural principle to follow but the other hand most ORMs <em>allow</em> doing it right</p><p><img loading="lazy" alt="Medium importance" src="data:image/png;base64,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" width="200" height="52" class="img_ev3q"></p><p><strong>ğŸ† Is Prisma doing better?:</strong> Yes!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-documentation-and-developer-experience">5. Documentation and developer-experience<a class="hash-link" href="#5-documentation-and-developer-experience" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> TypeORM and Sequelize documentation is mediocre, though TypeORM is a little better. Based on my personal experience they do get a little better over the years, but still by no mean they deserve to be called "good" or "great". For example, if you seek to learn about 'raw queries' - Sequelize offers <a href="https://sequelize.org/docs/v6/core-concepts/raw-queries/" target="_blank" rel="noopener noreferrer">a very short page</a> on this matter, TypeORM info is spread in multiple other pages. Looking to learn about pagination? Couldn't find Sequelize documents, TypeORM has <a href="https://typeorm.io/select-query-builder#using-pagination" target="_blank" rel="noopener noreferrer">some short explanation</a>, 150 words only</p><p><strong>ğŸ¤” How Prisma is different:</strong> Prisma documentation rocks! See their documents on similar topics: <a href="https://www.prisma.io/docs/concepts/components/prisma-client/raw-database-access" target="_blank" rel="noopener noreferrer">raw queries</a> and <a href="https://www.prisma.io/docs/concepts/components/prisma-client/pagination" target="_blank" rel="noopener noreferrer">pagingation</a>, thousands of words, and dozens of code examples. The writing itself is also great, feels like some professional writers were involved</p><p><img loading="lazy" alt="Prisma docs are comprehensive" src="/assets/images/count-docs-71e2e829f7c59b9d652603c03c373dea.png" width="683" height="458" class="img_ev3q"></p><p>This chart above shows how comprehensive are Prisma docs (Obviously this by itself doesn't prove quality)</p><p><strong>ğŸ“Š How important:</strong> Great docs are a key to awareness and avoiding pitfalls</p><p><img loading="lazy" alt="Medium importance" src="data:image/png;base64,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" width="200" height="52" class="img_ev3q"></p><p><strong>ğŸ† Is Prisma doing better?:</strong> You bet</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-observability-metrics-and-tracing">6. Observability, metrics, and tracing<a class="hash-link" href="#6-observability-metrics-and-tracing" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> Good chances are (say about 99.9%) that you'll find yourself diagnostic slow queries in production or any other DB-related quirks. What can you expect from traditional ORMs in terms of observability? Mostly logging. <a href="https://sequelize.org/api/v7/interfaces/queryoptions#benchmark" target="_blank" rel="noopener noreferrer">Sequelize provides both logging</a> of query duration and programmatic access to the connection pool state ({size,available,using,waiting}). <a href="https://orkhan.gitbook.io/typeorm/docs/logging" target="_blank" rel="noopener noreferrer">TypeORM provides only logging</a> of queries that suppress a pre-defined duration threshold. This is better than nothing, but assuming you don't read production logs 24/7, you'd probably need more than logging - an alert to fire when things seem faulty. To achieve this, it's your responsibility to bridge this info to your preferred monitoring system. Another logging downside for this sake is verbosity - we need to emit tons of information to the logs when all we really care for is the average duration. Metrics can serve this purpose much better as we're about to see soon with Prisma</p><p>What if you need to dig into which specific part of the query is slow? unfortunately, there is no breakdown of the query phases duration - it's being left to you as a black-box</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Sequelize - logging various DB information</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="Logging query duration" src="/assets/images/sequelize-log-af147131006e4207620f8e3918724ecc.png" width="1694" height="130" class="img_ev3q">
Logging each query in order to realize trends and anomaly in the monitoring system</p><p><strong>ğŸ¤” How Prisma is different:</strong> Since Prisma targets also enterprises, it must bring strong ops capabilities. Beautifully, it packs support for both <a href="https://www.prisma.io/docs/concepts/components/prisma-client/metrics" target="_blank" rel="noopener noreferrer">metrics</a> and <a href="https://www.prisma.io/docs/concepts/components/prisma-client/opentelemetry-tracing" target="_blank" rel="noopener noreferrer">open telemetry tracing</a>!. For metrics, it generates custom JSON with metric keys and values so anyone can adapt this to any monitoring system (e.g., CloudWatch, statsD, etc). On top of this, it produces out of the box metrics in <a href="https://prometheus.io/" target="_blank" rel="noopener noreferrer">Prometheus</a> format (one of the most popular monitoring platforms). For example, the metric 'prisma_client_queries_duration_histogram_ms' provides the average query length in the system overtime. What is even more impressive is the support for open-tracing - it feeds your OpenTelemetry collector with spans that describe the various phases of every query. For example, it might help realize what is the bottleneck in the query pipeline: Is it the DB connection, the query itself or the serialization?</p><p><img loading="lazy" alt="prisma tracing" src="data:image/png;base64,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" width="975" height="261" class="img_ev3q">
Prisma visualizes the various query phases duration with open-telemtry </p><p><strong>ğŸ† Is Prisma doing better?:</strong> Definitely</p><p><strong>ğŸ“Š How important:</strong> Goes without words how impactful is observability, however filling the gap in other ORM will demand no more than a few days</p><p><img loading="lazy" alt="Medium importance" src="data:image/png;base64,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" width="200" height="52" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-continuity---will-it-be-here-with-us-in-20242025">7. Continuity - will it be here with us in 2024/2025<a class="hash-link" href="#7-continuity---will-it-be-here-with-us-in-20242025" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> We live quite peacefully with the risk of one of our dependencies to disappear. With ORM though, this risk demand special attention because our buy-in is higher (i.e., harder to replace) and maintaining it was proven to be harder. Just look at a handful of successful ORMs in the past: objection.js, waterline, bookshelf - all of these respectful project had 0 commits in the past month. The single maintainer of objection.js <a href="https://github.com/Vincit/objection.js/issues/2335" target="_blank" rel="noopener noreferrer">announced that he won't work the project anymore</a>. This high churn rate is not surprising given the huge amount of moving parts to maintain, the gazillion corner cases and the modest 'budget' OSS projects live with. Looking at OpenCollective shows that <a href="https://opencollective.com/sequelize#category-BUDGET" target="_blank" rel="noopener noreferrer">Sequelize</a> and <a href="https://opencollective.com/typeorm" target="_blank" rel="noopener noreferrer">TypeORM</a> are funded with ~1500$ month in average. This is barely enough to cover a daily Starbucks cappuccino and croissant (6.95$ x 365) for 5 maintainers. Nothing contrasts this model more than a startup company that just raised its series B - Prisma is <a href="https://www.prisma.io/blog/series-b-announcement-v8t12ksi6x#:~:text=We%20are%20excited%20to%20announce,teams%20%26%20organizations%20in%20this%20article." target="_blank" rel="noopener noreferrer">funded with 40,000,000$ (40 millions)</a> and recruited 80 people! Should not this inspire us with high confidence about their continuity? I'll surprisingly suggest that quite the opposite is true</p><p>See, an OSS ORM has to go over one huge hump, but a startup company must pass through TWO. The OSS project will struggle to achieve the critical mass of features, including some high technical barriers (e.g., TypeScript support, ESM). This typically lasts years, but once it does - a project can focus mostly on maintenance and step out of the danger zone. The good news for TypeORM and Sequelize is that they already did! Both struggled to keep their heads above the water, there were rumors in the past that <a href="https://github.com/typeorm/typeorm/issues/3267" target="_blank" rel="noopener noreferrer">TypeORM is not maintained anymore</a>, but they managed to go through this hump. I counted, both projects had approximately ~2000 PRs in the past 3 years! Going with <a href="https://repo-tracker.com/r/gh/sequelize/sequelize" target="_blank" rel="noopener noreferrer">repo-tracker</a>, each see multiple commits every week. They both have vibrant traction, and the majority of features you would expect from an ORM. TypeORM even supports beyond-the-basics features like multi data source and caching. It's unlikely that now, once they reached the promise land - they will fade away. It might happen, there is no guarantee in the OSS galaxy, but the risk is low</p><p><img loading="lazy" alt="One hump" src="/assets/images/one-hump-dbd2860e9cff3ebe16ced6cf7c4ec64f.png" width="926" height="613" class="img_ev3q"></p><p><strong>ğŸ¤” How Prisma is different:</strong> Prisma a little lags behind in terms of features, but with a budget of 40M$ - there are good reasons to believe that they will pass the first hump, achieving a critical mass of features. I'm more concerned with the second hump - showing revenues in 2 years or saying goodbye. As a company that is backed by venture capitals - the model is clear and cruel: In order to secure their next round, series B or C (depends whether the seed is counted), there must be a viable and proven business model. How do you 'sell' ORM? Prisma experiments with multiple products, none is mature yet or being paid for. How big is this risk? According to <a href="https://spdload.com/blog/startup-success-rate/" target="_blank" rel="noopener noreferrer">this startup companies success statistics</a>, "About 65% of the Series A startups get series B, while 35% of the companies that get series A fail.". Since Prisma already gained a lot of love and adoption from the community, there success chances are higher than the average round A/B company, but even 20% or 10% chances to fade away is concerning</p><blockquote><p>This is terrifying news - companies happily choose a young commercial OSS product without realizing that there are 10-30% chances for this product to disappear</p></blockquote><p><img loading="lazy" alt="Two humps" src="/assets/images/two-humps-c54bed6a1428c1ad0f7e028d10a44206.png" width="989" height="531" class="img_ev3q"></p><p>Some of startup companies who seek a viable business model do not shut the doors rather change the product, the license or the free features. This is not my subjective business analysis, here are few examples: <a href="https://techcrunch.com/2018/10/16/mongodb-switches-up-its-open-source-license/" target="_blank" rel="noopener noreferrer">MongoDB changed their license</a>, this is why the majority had to host their Mongo DB over a single vendor. <a href="https://techcrunch.com/2019/02/21/redis-labs-changes-its-open-source-license-again/" target="_blank" rel="noopener noreferrer">Redis did something similar</a>. What are the chances of Prisma pivoting to another type of product? It actually already happened before, Prisma 1 was mostly about graphQL client and server, <a href="https://github.com/prisma/prisma1" target="_blank" rel="noopener noreferrer">it's now retired</a></p><p>It's just fair to mention the other potential path - most round B companies do succeed to qualify for the next round, when this happens even bigger money will be involved in building the 'Ferrari' of JavaScript ORMs. I'm surely crossing my fingers for these great people, at the same time we have to be conscious about our choices</p><p><strong>ğŸ“Š How important:</strong> As important as having to code again the entire DB layer in a big system</p><p><img loading="lazy" alt="Medium importance" src="data:image/png;base64,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" width="200" height="53" class="img_ev3q"></p><p><strong>ğŸ† Is Prisma doing better?:</strong> Quite the opposite</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="closing---what-should-you-use-now">Closing - what should you use now?<a class="hash-link" href="#closing---what-should-you-use-now" title="Direct link to heading">â€‹</a></h2><p>Before proposing my key take away - which is the primary ORM, let's repeat the key learning that were introduced here:</p><ol><li>ğŸ¥‡ Prisma deserves a medal for its awesome DX, documentation, observability support and end-to-end TypeScript coverage</li><li>ğŸ¤” There are reasons to be concerned about Prisma's business continuity as a young startup without a viable business model. Also Prisma's abstract client syntax might blind developers a little more than other ORMs</li><li>ğŸ© The contenders, TypeORM and Sequelize, matured and doing quite well: both have merged thousand PRs in the past 3 years to become more stable, they keep introducing new releases (see <a href="https://repo-tracker.com/r/gh/sequelize/sequelize" target="_blank" rel="noopener noreferrer">repo-tracker</a>), and for now holds more features than Prisma. Also, both show solid performance (for an ORM). Hats off to the maintainers!</li></ol><p>Based on these observations, which should you pick? which ORM will we use for <a href="https://github.com/practicajs/practica" target="_blank" rel="noopener noreferrer">practica.js</a>?</p><p>Prisma is an excellent addition to Node.js ORMs family, but not the hassle-free one tool to rule them all. It's a mixed bag of many delicious candies and a few gotchas. Wouldn't it grow to tick all the boxes? Maybe, but unlikely. Once built, it's too hard to dramatically change the syntax and engine performance. Then, during the writing and speaking with the community, including some Prisma enthusiasts, I realized that it doesn't aim to be the can-do-everything 'Ferrari'. Its positioning seems to resemble more a convenient family car with a solid engine and awesome user experience. In other words, it probably aims for the enterprise space where there is mostly demand for great DX, OK performance, and business-class support</p><p>In the end of this journey I see no dominant flawless 'Ferrari' ORM. I should probably change my perspective: Building ORM for the hectic modern JavaScript ecosystem is 10x harder than building a Java ORM back then in 2001. There is no stain in the shirt, it's a cool JavaScript swag. I learned to accept what we have, a rich set of features, tolerable performance, good enough for many systems. Need more? Don't use ORM. Nothing is going to change dramatically, it's now as good as it can be</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="when-will-it-shine">When will it shine?<a class="hash-link" href="#when-will-it-shine" title="Direct link to heading">â€‹</a></h3><p><strong>Surely use Prisma under these scenarios -</strong> If your data needs are rather simple; when time-to-market concern takes precedence over the  data processing accuracy; when the DB is relatively small; if you're a mobile/frontend developer who is doing her first steps in the backend world; when there is a need for business-class support; AND when Prisma's long term business continuity risk is a non-issue for you</p><p><strong>I'd probably prefer other options under these conditions -</strong> If the DB layer performance is a major concern; if you're savvy backend developer with solid SQL capabilities; when there is a need for fine grain control over the data layer. For all of these cases, Prisma might still work, but my primary choices would be using knex/TypeORM/Sequelize with a data-mapper style</p><p>Consequently, we love Prisma and add it behind flag (--orm=prisma) to Practica.js. At the same time, until some clouds will disappear, Sequelize will remain our default ORM</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="some-of-my-other-articles">Some of my other articles<a class="hash-link" href="#some-of-my-other-articles" title="Direct link to heading">â€‹</a></h2><ul><li><a href="https://github.com/testjavascript/nodejs-integration-tests-best-practices" target="_blank" rel="noopener noreferrer">Book: Node.js testing best practices</a></li><li><a href="https://github.com/testjavascript/nodejs-integration-tests-best-practices" target="_blank" rel="noopener noreferrer">Book: JavaScript testing best practices</a></li><li><a href="https://practica.dev/blog/popular-nodejs-pattern-and-tools-to-reconsider" target="_blank" rel="noopener noreferrer">Popular Node.js patterns and tools to re-consider</a></li><li><a href="https://github.com/practicajs/practica" target="_blank" rel="noopener noreferrer">Practica.js - A Node.js starter</a></li><li><a href="https://github.com/goldbergyoni/nodebestpractices" target="_blank" rel="noopener noreferrer">Node.js best practices</a></li></ul>]]></content>
        <author>
            <name>Yoni Goldberg</name>
            <uri>https://github.com/goldbergyoni</uri>
        </author>
        <category label="node.js" term="node.js"/>
        <category label="express" term="express"/>
        <category label="nestjs" term="nestjs"/>
        <category label="fastify" term="fastify"/>
        <category label="passport" term="passport"/>
        <category label="dotenv" term="dotenv"/>
        <category label="supertest" term="supertest"/>
        <category label="practica" term="practica"/>
        <category label="testing" term="testing"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Which Monorepo is right for a Node.js BACKENDÂ now?]]></title>
        <id>monorepo-backend</id>
        <link href="https://practica.dev/blog/monorepo-backend"/>
        <updated>2022-11-07T11:00:00.000Z</updated>
        <summary type="html"><![CDATA[As a Node.js starter, choosing the right libraries and frameworks for our users is the bread and butter of our work in Practica.js. In this post, we'd like to share our considerations in choosing our monorepo tooling]]></summary>
        <content type="html"><![CDATA[<p>As a Node.js starter, choosing the right libraries and frameworks for our users is the bread and butter of our work in <a href="https://github.com/practicajs/practica" target="_blank" rel="noopener noreferrer">Practica.js</a>. In this post, we'd like to share our considerations in choosing our monorepo tooling</p><p><img loading="lazy" alt="Monorepos" src="/assets/images/monorepo-high-level-291b29cc962144a43d78143889ba5d3b.png" width="1400" height="796" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-are-we-lookingat">What are we looking&nbsp;at<a class="hash-link" href="#what-are-we-lookingat" title="Direct link to heading">â€‹</a></h2><p>The Monorepo market is hot like fire. Weirdly, now when the demand for Monoreps is exploding, one of the leading libraries â€”  <a href="https://github.com/lerna/lerna/issues/2703" target="_blank" rel="noopener noreferrer">Lerna- has just retired.</a>  When looking closely, it might not be just a coincidence â€” With so many disruptive and shiny features brought on by new vendors, Lerna failed to keep up with the pace and stay relevant. This bloom of new tooling gets many confused â€” What is the right choice for my next project? What should I look at when choosing a Monorepo tool? This post is all about curating this information overload, covering the new tooling, emphasizing what is important, and finally share some recommendations. If you are here for tools and features, youâ€™re in the right place, although you might find yourself on a soul-searching journey to what is your desired development workflow.</p><p>This post is concerned with backend-only and Node.js. It also scoped to  <em>typical</em>  business solutions. If youâ€™re Google/FB developer who is faced with 8,000 packages â€” sorry, you need special gear. Consequently, monster Monorepo tooling like  <a href="https://github.com/thundergolfer/example-bazel-monorepo" target="_blank" rel="noopener noreferrer">Bazel</a>  is left-out. We will cover here some of the most popular Monorepo tools including Turborepo, Nx, PNPM, Yarn/npm workspace, and Lerna (although itâ€™s not actually maintained anymore â€” itâ€™s a good baseline for comparison).</p><p>Letâ€™s start? When human beings use the term Monorepo, they typically refer to one or more of the following  <em>4 layers below.</em> Each one of them can bring value to your project, each has different consequences, tooling, and features:</p><h1>Layer 1: Plain old folders to stay on top of your code</h1><p>With zero tooling and only by having all the Microservice and libraries together in the same root folder, a developer gets great management perks and tons of value: Navigation, search across components, deleting a library instantly, debugging,  <em>quickly</em>  adding new components. Consider the alternative with multi-repo approach â€” adding a new component for modularity demands opening and configuring a new  GitHub  repository. Not just a hassle but also greater chances of developers choosing the short path and including the new code in some semi-relevant existing package. In plain words, zero-tooling Monorepos can increase modularity.</p><p>This layer is often overlooked. If your codebase is not huge and the components are highly decoupled (more on this later)â€” it might be all you need. Weâ€™ve seen a handful of successful Monorepo solutions without any special tooling.</p><p>With that said, some of the newer tools augment this experience with interesting features:</p><ul><li>Both  <a href="https://turborepo.org/" target="_blank" rel="noopener noreferrer">Turborepo</a>  and  <a href="https://nx.dev/structure/dependency-graph" target="_blank" rel="noopener noreferrer">Nx</a>  and also  <a href="https://www.npmjs.com/package/lerna-dependency-graph" target="_blank" rel="noopener noreferrer">Lerna</a>  provide a visual representation of the packagesâ€™ dependencies</li><li><a href="https://nx.dev/structure/monorepo-tags" target="_blank" rel="noopener noreferrer">Nx allows â€˜visibility rulesâ€™</a>  which is about enforcing who can use what. Consider, a â€˜checkoutâ€™ library that should be approached only by the â€˜order Microserviceâ€™ â€” deviating from this will result in failure during development (not runtime enforcement)</li></ul><p><img loading="lazy" src="https://miro.medium.com/max/1400/0*pHZKRlGT6iOKCmzg.jpg" class="img_ev3q"></p><p>Nx dependencies graph</p><ul><li><a href="https://nx.dev/generators/workspace-generators" target="_blank" rel="noopener noreferrer">Nx workspace generator</a>  allows scaffolding out components. Whenever a team member needs to craft a new controller/library/class/Microservice, she just invokes a CLI command which products code based on a community or organization template. This enforces consistency and best practices sharing</li></ul><h1>Layer 2: Tasks and pipeline to build your code efficiently</h1><p>Even in a world of autonomous components, there are management tasks that must be applied in a batch like applying a security patch via npm update, running the tests of  <em>multiple</em>  components that were affected by a change, publish 3 related libraries to name a few examples. All Monorepo tools support this basic functionality of invoking some command over a group of packages. For example, Lerna, Nx, and Turborepo do.</p><p><img loading="lazy" src="https://miro.medium.com/max/1400/1*wu7xtN97-Ihz4uCSDwd0mA.png" class="img_ev3q"></p><p>Apply some commands over multiple packages</p><p>In some projects, invoking a cascading command is all you need. Mostly if each package has an autonomous life cycle and the build process spans a single package (more on this later). In some other types of projects where the workflow demands testing/running and publishing/deploying many packages together â€” this will end in a terribly slow experience. Consider a solution with hundred of packages that are transpiled and bundled â€” one might wait minutes for a wide test to run. While itâ€™s not always a great practice to rely on wide/E2E tests, itâ€™s quite common in the wild. This is exactly where the new wave of Monorepo tooling shines â€”  <em>deeply</em>  optimizing the build process. I should say this out loud: These tools bring beautiful and innovative build optimizations:</p><ul><li><strong>Parallelization â€”</strong> If two commands or packages are orthogonal to each other, the commands will run in two different threads or processes. Typically your quality control involves testing, lining, license checking, CVE checking â€” why not parallelize?</li><li><strong>Smart execution plan â€”</strong>Beyond parallelization, the optimized tasks execution order is determined based on many factors. Consider a build that includes A, B, C where A, C depend on B â€” naively, a build system would wait for B to build and only then run A &amp; C. This can be optimized if we run A &amp; Câ€™s  <em>isolated</em>  unit tests  <em>while</em> building B and not afterward. By running task in parallel as early as possible, the overall execution time is improved â€” this has a remarkable impact mostly when hosting a high number of components. See below a visualization example of a pipeline improvement</li></ul><p><img loading="lazy" src="https://miro.medium.com/max/1400/0*C6cxCblQU8ckTIQk.png" class="img_ev3q"></p><p>A modern tool advantage over old Lerna. Taken from Turborepo website</p><ul><li><strong>Detect who is affected by a change â€”</strong>  Even on a system with high coupling between packages, itâ€™s usually not necessary to run  <em>all</em> packages rather than only those who are affected by a change. What exactly is â€˜affectedâ€™? Packages/Microservices that depend upon another package that has changed. Some of the toolings can ignore minor changes that are unlikely to break others. This is not a great performance booster but also an amazing testing feature â€”developers can get quick feedback on whether any of their clients were broken. Both Nx and Turborepo support this feature. Lerna can tell only which of the Monorepo package has changed</li><li><strong>Sub-systems (i.e., projects) â€”</strong> Similarly to â€˜affectedâ€™ above, modern tooling can realize portions of the graph that are inter-connected (a project or application) while others are not reachable by the component in context (another project) so they know to involve only packages of the relevant group</li><li><strong>Caching â€”</strong> This is a serious speed booster: Nx and Turborepo cache the result/output of tasks and avoid running them again on consequent builds if unnecessary. For example, consider long-running tests of a Microservice, when commanding to re-build this Microservice, the tooling might realize that nothing has changed and the test will get skipped. This is achieved by generating a hashmap of all the dependent resources â€” if any of these resources havenâ€™t change, then the hashmap will be the same and the task will get skipped. They even cache the stdout of the command, so when you run a cached version it acts like the real thing â€” consider running 200 tests, seeing all the log statements of the tests, getting results over the terminal in 200 ms, everything acts like â€˜real testing while in fact, the tests did not run at all rather the cache!</li><li><strong>Remote caching â€”</strong> Similarly to caching, only by placing the taskâ€™s hashmaps and result on a global server so further executions on other team memberâ€™s computers will also skip unnecessary tasks. In huge Monorepo projects that rely on E2E tests and must build all packages for development, this can save a great deal of time</li></ul><h1>Layer 3: Hoist your dependencies to boost npm installation</h1><p>The speed optimizations that were described above wonâ€™t be of help if the bottleneck is the big bull of mud that is called â€˜npm installâ€™ (not to criticize, itâ€™s just hard by nature). Take a typical scenario as an example, given dozens of components that should be built, they could easily trigger the installation of thousands of sub-dependencies. Although they use quite similar dependencies (e.g., same logger, same ORM), if the dependency version is not equal then npm will duplicate (<a href="https://rushjs.io/pages/advanced/npm_doppelgangers/" target="_blank" rel="noopener noreferrer">the NPM doppelgangers problem</a>) the installation of those packages which might result in a long process.</p><p>This is where the workspace line of tools (e.g., Yarn workspace, npm workspaces, PNPM) kicks in and introduces some optimization â€” Instead of installing dependencies inside each component â€˜NODE_MODULESâ€™ folder, it will create one centralized folder and link all the dependencies over there. This can show a tremendous boost in install time for huge projects. On the other hand, if you always focus on one component at a time, installing the packages of a single Microservice/library should not be a concern.</p><p>Both Nx and Turborepo can rely on the package manager/workspace to provide this layer of optimizations. In other words, Nx and Turborepo are the layer above the package manager who take care of optimized dependencies installation.</p><p><img loading="lazy" src="https://miro.medium.com/max/1400/1*dhyCWSbzpIi5iagR4OB4zQ.png" class="img_ev3q"></p><p>On top of this, Nx introduces one more non-standard, maybe even controversial, technique: There might be only ONE package.json at the root folder of the entire Monorepo. By default, when creating components using Nx, they will not have their own package.json! Instead, all will share the root package.json.  Going this way, all the Microservice/libraries share their dependencies and the installation time is improved.  Note: Itâ€™s possible to create â€˜publishableâ€™ components that do have a package.json, itâ€™s just not the default.</p><p>Iâ€™m concerned here. Sharing dependencies among packages increases the coupling, what if Microservice1 wishes to bump dependency1 version but Microservice2 canâ€™t do this at the moment? Also, package.json is part of Node.js  <em>runtime</em> and excluding it from the component root loses important features like package.json main field or ESM exports (telling the clients which files are exposed). I ran some POC with Nx last week and found myself blocked â€” library B was wadded, I tried to import it from Library A but couldnâ€™t get the â€˜importâ€™ statement to specify the right package name. The natural action was to open Bâ€™s package.json and check the name, but there is no Package.jsonâ€¦ How do I determine its name? Nx docs are great, finally, I found the answer, but I had to spend time learning a new â€˜frameworkâ€™.</p><h1>Stop for a second: Itâ€™s all about your workflow</h1><p>We deal with tooling and features, but itâ€™s actually meaningless evaluating these options before determining whether your preferred workflow is  <em>synchronized or independent</em> (we will discuss this in a few seconds)<em>.</em> This upfront  <em>fundamental</em>  decision will change almost everything.</p><p>Consider the following example with 3 components: Library 1 is introducing some major and breaking changes, Microservice1 and Microservice2 depend upon Library1 and should react to those breaking changes. How?</p><p><strong>Option A â€” The synchronized workflow-</strong> Going with this development style, all the three components will be developed and deployed in one chunk  <em>together</em>. Practically, a developer will code the changes in Library1, test libray1 and also run wide integration/e2e tests that include Microservice1 and Microservice2. When they're ready, the version of all components will get bumped. Finally, they will get deployed  <em>together.</em></p><p>Going with this approach, the developer has the chance of seeing the full flow from the client's perspective (Microservice1 and 2), the tests cover not only the library but also through the eyes of the clients who actually use it. On the flip side, it mandates updating all the depend-upon components (could be dozens), doing so increases the riskâ€™s blast radius as more units are affected and should be considered before deployment. Also, working on a large unit of work demands building and testing more things which will slow the build.</p><p><strong>Option B â€” Independent workflow-</strong> This style is about working a unit by unit, one bite at a time, and deploy each component independently based on its personal business considerations and priority. This is how it goes: A developer makes the changes in Library1, they must be tested carefully in the scope of Library1. Once she is ready, the SemVer is bumped to a new major and the library is published to a package manager registry (e.g., npm). What about the client Microservices? Well, the team of Microservice2 is super-busy now with other priorities, and skip this update for now (the same thing as we all delay many of our npm updates,). However, Microservice1 is very much interested in this change â€” The team has to pro-actively update this dependency and grab the latest changes, run the tests and when they are ready, today or next week â€” deploy it.</p><p>Going with the independent workflow, the library author can move much faster because she does not need to take into account 2 or 30 other components â€” some are coded by different teams. This workflow also  <em>forces her</em>  to write efficient tests against the library â€” itâ€™s her only safety net and is likely to end with autonomous components that have low coupling to others. On the other hand, testing in isolation without the clientâ€™s perspective loses some dimension of realism. Also, if a single developer has to update 5 units â€” publishing each individually to the registry and then updating within all the dependencies can be a little tedious.</p><p><img loading="lazy" src="https://miro.medium.com/max/1400/1*eeJFL3_vo5tCrWvVY-surg.png" class="img_ev3q"></p><p>Synchronized and independent workflows illustrated</p><p><strong>On the illusion of synchronicity</strong></p><p>In distributed systems, itâ€™s not feasible to achieve 100% synchronicity â€” believing otherwise can lead to design faults. Consider a breaking change in Microservice1, now its client Microservice2 is adapting and ready for the change. These two Microservices are deployed together but due to the nature of Microservices and distributed runtime (e.g., Kubernetes) the deployment of Microservice1 only fail. Now, Microservice2â€™s code is not aligned with Microservice1 production and we are faced with a production bug. This line of failures can be handled to an extent also with a synchronized workflow â€” The deployment should orchestrate the rollout of each unit so each one is deployed at a time. Although this approach is doable, it increased the chances of large-scoped rollback and increases deployment fear.</p><p>This fundamental decision, synchronized or independent, will determine so many things â€” Whether performance is an issue or not at all (when working on a single unit), hoisting dependencies or leaving a dedicated node_modules in every packageâ€™s folder, and whether to create a local link between packages which is described in the next paragraph.</p><h1>Layer 4: Link your packages for immediate feedback</h1><p>When having a Monorepo, there is always the unavoidable dilemma of how to link between the components:</p><p><strong>Option 1: Using npm â€”</strong> Each library is a standard npm package and its client installs it via the standards npm commands. Given Microservice1 and Library1, this will end with two copies of Library1: the one inside Microservices1/NODE_MODULES (i.e., the local copy of the consuming Microservice), and the 2nd is the development folder where the team is coding Library1.</p><p><strong>Option2: Just a plain folder â€”</strong> With this, Library1 is nothing but a logical module inside a folder that Microservice1,2,3 just locally imports. NPM is not involved here, itâ€™s just code in a dedicated folder. This is for example how Nest.js modules are represented.</p><p>With option 1, teams benefit from all the great merits of a package manager â€” SemVer(!), tooling, standards, etc. However, should one update Library1, the changes wonâ€™t get reflected in Microservice1 since it is grabbing its copy from the npm registry and the changes were not published yet. This is a fundamental pain with Monorepo and package managers â€” one canâ€™t just code over multiple packages and test/run the changes.</p><p>With option 2, teams lose all the benefits of a package manager: Every change is propagated immediately to all of the consumers.</p><p>How do we bring the good from both worlds (presumably)? Using linking. Lerna, Nx, the various package manager workspaces (Yarn, npm, etc) allow using npm libraries and at the same time link between the clients (e.g., Microservice1) and the library. Under the hood, they created a symbolic link. In development mode, changes are propagated immediately, in deployment time â€” the copy is grabbed from the registry.</p><p><img loading="lazy" src="https://miro.medium.com/max/1400/1*9PkNrnbnibFdbvPieq-y9g.png" class="img_ev3q"></p><p>Linking packages in a Monorepo</p><p>If youâ€™re doing the synchronized workflow, youâ€™re all set. Only now any risky change that is introduced by Library3, must be handled NOW by the 10 Microservices that consume it.</p><p>If favoring the independent workflow, this is of course a big concern. Some may call this direct linking style a â€˜monolith monorepoâ€™, or maybe a â€˜monolithoâ€™. However, when not linking, itâ€™s harder to debug a small issue between the Microservice and the npm library. What I typically do is  <em>temporarily link</em> (with npm link) between the packages<em>,</em>  debug, code, then finally remove the link.</p><p>Nx is taking a slightly more disruptive approach â€” it is using  <a href="https://www.typescriptlang.org/tsconfig#paths" target="_blank" rel="noopener noreferrer">TypeScript paths</a>  to bind between the components. When Microservice1 is importing Library1, to avoid the full local path, it creates a TypeScript mapping between the library name and the full path. But wait a minute, there is no TypeScript in production so how could it work? Well, in serving/bundling time it webpacks and stitches the components together. Not a very standard way of doing Node.js work.</p><h1>Closing: What should you use?</h1><p>Itâ€™s all about your workflow and architecture â€” a huge unseen cross-road stands in front of the Monorepo tooling decision.</p><p><strong>Scenario A â€”</strong> If your architecture dictates a  <em>synchronized workflow</em>  where all packages are deployed together, or at least developed in collaboration â€” then there is a strong need for a rich tool to manage this coupling and boost the performance. In this case, Nx might be a great choice.</p><p>For example, if your Microservice must keep the same versioning, or if the team really small and the same people are updating all the components, or if your modularization is not based on package manager but rather on framework-own modules (e.g., Nest.js), if youâ€™re doing frontend where the components inherently are published together, or if your testing strategy relies on E2E mostly â€” for all of these cases and others, Nx is a tool that was built to enhance the experience of coding many  <em>relatively</em> coupled components together. It is a great a sugar coat over systems that are unavoidably big and linked.</p><p>If your system is not inherently big or meant to synchronize packages deployment, fancy Monorepo features might increase the coupling between components. The Monorepo pyramid above draws a line between basic features that provide value without coupling components while other layers come with an architectural price to consider. Sometimes climbing up toward the tip is worth the consequences, just make this decision consciously.</p><p><img loading="lazy" src="https://miro.medium.com/max/1400/1*c2qYYpVGG667bkum-gB-5Q.png" class="img_ev3q"></p><p><strong>Scenario Bâ€”</strong> If youâ€™re into an  <em>independent workflow</em> where each package is developed, tested, and deployed (almost) independently â€” then inherently there is no need to fancy tools to orchestrate hundreds of packages. Most of the time there is just one package in focus. This calls for picking a leaner and simpler tool â€” Turborepo. By going this route, Monorepo is not something that affects your architecture, but rather a scoped tool for faster build execution. One specific tool that encourages an independent workflow is  <a href="https://github.com/giltayar/bilt" target="_blank" rel="noopener noreferrer">Bilt</a>  by Gil Tayar, itâ€™s yet to gain enough popularity but it might rise soon and is a great source to learn more about this philosophy of work.</p><p><strong>In any scenario, consider workspaces â€”</strong> If you face performance issues that are caused by package installation, then the various workspace tools Yarn/npm/PNPM, can greatly minimize this overhead with a low footprint. That said, if youâ€™re working in an autonomous workflow, smaller are the chances of facing such issues. Donâ€™t just use tools unless there is a pain.</p><p>We tried to show the beauty of each and where it shines. If weâ€™re allowed to end this article with an opinionated choice: We greatly believe in an independent and autonomous workflow where the occasional developer of a package can code and deploy fearlessly without messing with dozens of other foreign packages. For this reason, Turborepo will be our favorite tool for the next season. We promise to tell you how it goes.</p><h1>Bonus: Comparison table</h1><p>See below a detailed comparison table of the various tools and features:</p><p><img loading="lazy" src="https://miro.medium.com/max/1400/1*iHX_IdPW8XXXiZTyjFo6bw.png" class="img_ev3q"></p><p>Preview only, the complete table can be  <a href="https://github.com/practicajs/practica/blob/main/docs/docs/decisions/monorepo.md" target="_blank" rel="noopener noreferrer">found here</a></p>]]></content>
        <author>
            <name>Yoni Goldberg</name>
            <uri>https://github.com/goldbergyoni</uri>
        </author>
        <author>
            <name>Michael Salomon</name>
            <uri>https://github.com/mikicho</uri>
        </author>
        <category label="monorepo" term="monorepo"/>
        <category label="decisions" term="decisions"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Popular Node.js patterns and tools to re-consider]]></title>
        <id>popular-nodejs-pattern-and-tools-to-reconsider</id>
        <link href="https://practica.dev/blog/popular-nodejs-pattern-and-tools-to-reconsider"/>
        <updated>2022-08-02T10:00:00.000Z</updated>
        <summary type="html"><![CDATA[Node.js is maturing. Many patterns and frameworks were embraced - it's my belief that developers' productivity dramatically increased in the past years. One downside of maturity is habits - we now reuse existing techniques more often. How is this a problem?]]></summary>
        <content type="html"><![CDATA[<p>Node.js is maturing. Many patterns and frameworks were embraced - it's my belief that developers' productivity dramatically increased in the past years. One downside of maturity is habits - we now reuse existing techniques more often. How is this a problem?</p><p>In his novel book 'Atomic Habits' the author James Clear states that:</p><blockquote><p>"Mastery is created by habits. However, sometimes when we're on auto-pilot performing habits, we tend to slip up... Just being we are gaining experience through performing the habits does not mean that we are improving. We actually go backwards on the improvement scale with most habits that turn into auto-pilot". In other words, practice makes perfect, and bad practices make things worst</p></blockquote><p>We copy-paste mentally and physically things that we are used to, but these things are not necessarily right anymore. Like animals who shed their shells or skin to adapt to a new reality, so the Node.js community should constantly gauge its existing patterns, discuss and change</p><p>Luckily, unlike other languages that are more committed to specific design paradigms (Java, Ruby) - Node is a house of many ideas. In this community, I feel safe to question some of our good-old tooling and patterns. The list below contains my personal beliefs, which are brought with reasoning and examples. </p><p>Are those disruptive thoughts surely correct? I'm not sure. There is one things I'm sure about though - For Node.js to live longer, we need to encourage critics, focus our loyalty on innovation, and keep the discussion going. The outcome of this discussion is not "don't use this tool!" but rather becoming familiar with other techniques that, <em>under some circumstances</em> might be a better fit</p><p><img loading="lazy" alt="Animals and frameworks shed their skin" src="/assets/images/crab-161f2b8e5ab129c2a175920691a845c0.webp" width="600" height="400" class="img_ev3q"></p><p><em>The True Crab's exoskeleton is hard and inflexible, he must shed his restrictive exoskeleton to grow and reveal the new roomier shell</em></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="toc---patterns-to-reconsider">TOC - Patterns to reconsider<a class="hash-link" href="#toc---patterns-to-reconsider" title="Direct link to heading">â€‹</a></h2><ol><li>Dotenv</li><li>Calling a service from a controller</li><li>Nest.js dependency injection for all classes</li><li>Passport.js</li><li>Supertest</li><li>Fastify utility decoration</li><li>Logging from a catch clause</li><li>Morgan logger</li><li>NODE_ENV</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-dotenv-as-your-configuration-source">1. Dotenv as your configuration source<a class="hash-link" href="#1-dotenv-as-your-configuration-source" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> A super popular technique in which the app configurable values (e.g., DB user name) are stored in a simple text file. Then, when the app loads, the dotenv library sets all the text file values as environment variables so the code can read this</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// .env file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">USER_SERVICE_URL</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">myorg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//start.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'dotenv'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//blog-post-service.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">repository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">savePost</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//update the user number of posts, read the users service URL from an environment variable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> axios</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">process</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">env</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation constant" style="color:#36acaa">USER_SERVICE_URL</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/api/user/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">post</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">userId</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/incrementPosts</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ğŸ“Š How popular:</strong> 21,806,137 downloads/week!</p><p><strong>ğŸ¤” Why it might be wrong:</strong> Dotenv is so easy and intuitive to start with, so one might easily overlook fundamental features: For example, it's hard to infer the configuration schema and realize the meaning of each key and its typing. Consequently, there is no built-in way to fail fast when a mandatory key is missing - a flow might fail after starting and presenting some side effects (e.g., DB records were already mutated before the failure). In the example above, the blog post will be saved to DB, and only then will the code realize that a mandatory key is missing - This leaves the app hanging in an invalid state. On top of this, in the presence of many keys, it's impossible to organize them hierarchically. If not enough, it encourages developers to commit this .env file which might contain production values - this happens because there is no clear way to define development defaults. Teams usually work around this by committing .env.example file and then asking whoever pulls code to rename this file manually. If they remember to of course</p><p><strong>â˜€ï¸ Better alternative:</strong> Some configuration libraries provide out of the box solution to all of these needs. They encourage a clear schema and the possibility to validate early and fail if needed. See <a href="https://practica.dev/decisions/configuration-library" target="_blank" rel="noopener noreferrer">comparison of options here</a>. One of the better alternatives is <a href="https://github.com/mozilla/node-convict" target="_blank" rel="noopener noreferrer">'convict'</a>, down below is the same example, this time with Convict, hopefully it's better now:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// config.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">userService</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Hierarchical, documented and strongly typed ğŸ‘‡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">doc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"The URL of the user management service including a trailing slash"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">format</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"url"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword module" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://localhost:4001"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">nullable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">env</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"USER_SERVICE_URL"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//more keys here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//start.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">convict</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"convict"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">configSchema</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"config"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">convict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">configSchema</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Fail fast!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">convictConfigurationProvider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">validate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//blog-post.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">repository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">savePost</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Will never arrive here if the URL is not set</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> axios</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">convict</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">get</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">userService</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">url</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/api/user/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">post</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">userId</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/incrementPosts</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-calling-a-fat-service-from-the-api-controller">2. Calling a 'fat' service from the API controller<a class="hash-link" href="#2-calling-a-fat-service-from-the-api-controller" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> Consider a reader of our code who wishes to understand the entire <em>high-level</em> flow or delve into a very <em>specific</em> part. She first lands on the API controller, where requests start. Unlike what its name implies, this controller layer is just an adapter and kept really thin and straightforward. Great thus far. Then the controller calls a big 'service' with thousands of lines of code that represent the entire logic</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// user-controller</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">router</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> next</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> userService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Might have here try-catch or error response logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// user-service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exports </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">newUser</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Want to understand quickly? Need to understand the entire user service, 1500 loc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// It uses technical language and reuse narratives of other flows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">copyMoreFieldsToUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newUser</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> doesExist </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">updateIfAlreadyExists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newUser</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">doesExist</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">addToCache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newUser</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 20 more lines that demand navigating to other functions in order to get the intent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ğŸ“Š How popular:</strong> It's hard to pull solid numbers here, I could confidently say that in <em>most</em> of the app that I see, this is the case</p><p><strong>ğŸ¤” Why it might be wrong:</strong> We're here to tame complexities. One of the useful techniques is deferring a complexity to the later stage possible. In this case though, the reader of the code (hopefully) starts her journey through the tests and the controller - things are simple in these areas. Then, as she lands on the big service - she gets tons of complexity and small details, although she is focused on understanding the overall flow or some specific logic. This is <strong>unnecessary</strong> complexity</p><p><strong>â˜€ï¸ Better alternative:</strong> The controller should call a particular type of service, a <strong>use-case</strong> , which is responsible for <em>summarizing</em> the flow in a business and simple language. Each flow/feature is described using a use-case, each contains 4-10 lines of code, that tell the story without technical details. It mostly orchestrates other small services, clients, and repositories that hold all the implementation details. With use cases, the reader can grasp the high-level flow easily. She can now <strong>choose</strong> where she would like to focus. She is now exposed only to <strong>necessary</strong> complexity. This technique also encourages partitioning the code to the smaller object that the use-case orchestrates. Bonus: By looking at coverage reports, one can tell which features are covered, not just files/functions</p><p>This idea by the way is formalized in the <a href="https://www.bookdepository.com/Clean-Architecture-Robert-Martin/9780134494166?redirected=true&amp;utm_medium=Google&amp;utm_campaign=Base1&amp;utm_source=IL&amp;utm_content=Clean-Architecture&amp;selectCurrency=ILS&amp;w=AFF9AU99ZB4MTDA8VTRQ&amp;gclid=Cj0KCQjw3eeXBhD7ARIsAHjssr92kqLn60dnfQCLjbkaqttdgvhRV5dqKtnY680GCNDvKp-16HtZp24aAg6GEALw_wcB" target="_blank" rel="noopener noreferrer">'clean architecture' book</a> - I'm not a big fan of 'fancy' architectures, but see - it's worth cherry-picking techniques from every source. You may walk-through our <a href="https://github.com/practicajs/practica" target="_blank" rel="noopener noreferrer">Node.js best practices starter, practica.js</a>, and examine the use-cases code</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// add-order-use-case.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter literal-property property" style="color:#36acaa">newOrder</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> addOrderDTO</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  orderValidation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">assertOrderIsValid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newOrder</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> userWhoOrdered </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> userServiceClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getUserWhoOrdered</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    newOrder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">userId</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  paymentTermsService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">assertPaymentTerms</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    newOrder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">paymentTermsInDays</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userWhoOrdered</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">terms</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> orderRepository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newOrder</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-nestjs-wire-everything-with-dependency-injection">3. Nest.js: Wire <em>everything</em> with dependency injection<a class="hash-link" href="#3-nestjs-wire-everything-with-dependency-injection" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> If you're doing Nest.js, besides having a powerful framework in your hands, you probably use DI for <em>everything</em> and make every class injectable. Say you have a weather-service that depends upon humidity-service, and <strong>there is no requirement to swap</strong> the humidity-service with alternative providers. Nevertheless, you inject humidity-service into the weather-service. It becomes part of your development style, "why not" you think - I may need to stub it during testing or replace it in the future</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// humidity-service.ts - not customer facing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">Injectable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">GoogleHumidityService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getHumidity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">when</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Datetime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Fetches from some specific cloud service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// weather-service.ts - customer facing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> GoogleHumidityService </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./humidity-service.ts'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">weatherInfo</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    temperature</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    humidity</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">WeatherService</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> humidityService</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> GoogleHumidityService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetWeather</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">when</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Datetime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">weatherInfo</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Fetch temperature from somewhere and then humidity from GoogleHumidityService</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// app.module.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">Module</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  providers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">GoogleHumidityService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> WeatherService</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">AppModule</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ğŸ“Š How popular:</strong> No numbers here but I could confidently say that in <em>all</em> of the Nest.js app that I've seen, this is the case. In the popular <a href="https://github.com/lujakob/nestjs-realworld-example-app" target="_blank" rel="noopener noreferrer">'nestjs-realworld-example-ap[p'](</a>) all the services are 'injectable'</p><p><strong>ğŸ¤” Why it might be wrong:</strong> Dependency injection is not a priceless coding style but a pattern you should pull in the right moment, like any other pattern. Why? Because any pattern has a price. What price, you ask? First, encapsulation is violated. Clients of the weather-service are now aware that other providers are being used <em>internally</em>. Some clients may get tempted to override providers also it's not under their responsibility. Second, it's another layer of complexity to learn, maintain, and one more way to shoot yourself in the legs. StackOverflow owes some of its revenues to Nest.js DI - plenty of discussions try to solve this puzzle (e.g. did you know that in case of circular dependencies the order of imports matters?). Third, there is the performance thing - Nest.js, for example struggled to provide a decent start time for serverless environments and had to introduce <a href="https://docs.nestjs.com/fundamentals/lazy-loading-modules" target="_blank" rel="noopener noreferrer">lazy loaded modules</a>. Don't get me wrong, <strong>in some cases</strong>, there is a good case for DI: When a need arises to decouple a dependency from its caller, or to allow clients to inject custom implementations (e.g., the strategy pattern). <strong>In such case</strong>, when there is a value, you may consider whether the <em>value of DI is worth its price</em>. If you don't have this case, why pay for nothing?</p><p>I recommend reading the first paragraphs of this blog post <a href="https://www.tonymarston.net/php-mysql/dependency-injection-is-evil.html" target="_blank" rel="noopener noreferrer">'Dependency Injection is EVIL'</a> (and absolutely don't agree with this bold words)</p><p><strong>â˜€ï¸ Better alternative:</strong> 'Lean-ify' your engineering approach - avoid using any tool unless it serves a real-world need immediately. Start simple, a dependent class should simply import its dependency and use it - Yeah, using the plain Node.js module system ('require'). Facing a situation when there is a need to factor dynamic objects? There are a handful of simple patterns, simpler than DI, that you should consider, like 'if/else', factory function, and more. Are singletons requested? Consider techniques with lower costs like the module system with factory function. Need to stub/mock for testing? Monkey patching might be better than DI: better clutter your test code a bit than clutter your production code. Have a strong need to hide from an object where its dependencies are coming from? You sure? Use DI!</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// humidity-service.ts - not customer facing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getHumidity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">when</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Datetime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Fetches from some specific cloud service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// weather-service.ts - customer facing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> getHumidity </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./humidity-service.ts"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// âœ… No wiring is happening externally, all is flat and explicit. Simple</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getWeather</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">when</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Datetime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">number</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Fetch temperature from somewhere and then humidity from GoogleHumidityService</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Nobody needs to know about it, its an implementation details</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getHumidity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">when</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-min-pause-a-word-or-two-about-me-the-author">1 min pause: A word or two about me, the author<a class="hash-link" href="#1-min-pause-a-word-or-two-about-me-the-author" title="Direct link to heading">â€‹</a></h2><p>My name is Yoni Goldberg, I'm a Node.js developer and consultant. I wrote few code-books like <a href="https://github.com/goldbergyoni/javascript-testing-best-practices" target="_blank" rel="noopener noreferrer">JavaScript testing best practices</a> and <a href="https://github.com/goldbergyoni/nodebestpractices" target="_blank" rel="noopener noreferrer">Node.js best practices</a> (100,000 stars âœ¨ğŸ¥¹). That said, my best guide is <a href="https://github.com/testjavascript/nodejs-integration-tests-best-practices" target="_blank" rel="noopener noreferrer">Node.js testing practices</a> which only few read ğŸ˜. I shall release <a href="https://testjavascript.com/" target="_blank" rel="noopener noreferrer">an advanced Node.js testing course soon</a> and also hold workshops for teams. I'm also a core maintainer of <a href="https://github.com/practicajs/practica" target="_blank" rel="noopener noreferrer">Practica.js</a> which is a Node.js starter that creates a production-ready example Node Monorepo solution that is based on the standards and simplicity. It might be your primary option when starting a new Node.js solution</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-passportjs-for-token-authentication">4. Passport.js for token authentication<a class="hash-link" href="#4-passportjs-for-token-authentication" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> Commonly, you're in need to issue or/and authenticate JWT tokens. Similarly, you might need to allow login from <em>one</em> single social network like Google/Facebook. When faced with these kinds of needs, Node.js developers rush to the glorious library <a href="https://www.passportjs.org/" target="_blank" rel="noopener noreferrer">Passport.js</a> like butterflies are attracted to light</p><p><strong>ğŸ“Š How popular:</strong> 1,389,720 weekly downloads</p><p><strong>ğŸ¤” Why it might be wrong:</strong> When tasked with guarding your routes with JWT token - you're just a few lines of code shy from ticking the goal. Instead of messing up with a new framework, instead of introducing levels of indirections (you call passport, then it calls you), instead of spending time learning new abstractions - use a JWT library directly. Libraries like <a href="https://github.com/auth0/node-jsonwebtoken" target="_blank" rel="noopener noreferrer">jsonwebtoken</a> or <a href="https://github.com/nearform/fast-jwt" target="_blank" rel="noopener noreferrer">fast-jwt</a> are simple and well maintained. Have concerns with the security hardening? Good point, your concerns are valid. But would you not get better hardening with a direct understanding of your configuration and flow? Will hiding things behind a framework help? Even if you prefer the hardening of a battle-tested framework, Passport doesn't handle a handful of security risks like secrets/token, secured user management, DB protection, and more. My point, you probably anyway need fully-featured user and authentication management platforms. Various cloud services and OSS projects, can tick all of those security concerns. Why then start in the first place with a framework that doesn't satisfy your security needs? It seems like many who opt for Passport.js are not fully aware of which needs are satisfied and which are left open. All of that said, Passport definitely shines when looking for a quick way to support <em>many</em> social login providers</p><p><strong>â˜€ï¸ Better alternative:</strong> Is token authentication in order? These few lines of code below might be all you need. You may also glimpse into <a href="https://github.com/practicajs/practica/tree/main/src/code-templates/libraries/jwt-token-verifier" target="_blank" rel="noopener noreferrer">Practica.js wrapper around these libraries</a>. A real-world project at scale typically need more: supporting async JWT <a href="https://auth0.com/docs/secure/tokens/json-web-tokens/json-web-key-sets" target="_blank" rel="noopener noreferrer">(JWKS)</a>, securely manage and rotate the secrets to name a few examples. In this case, OSS solution like [keycloak (<a href="https://github.com/keycloak/keycloak" target="_blank" rel="noopener noreferrer">https://github.com/keycloak/keycloak</a>) or commercial options like Auth0<!-- -->[https://github.com/auth0]<!-- --> are alternatives to consider</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// jwt-middleware.js, a simplified version - Refer to Practica.js to see some more corner cases</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">middleware</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> next</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">headers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">authorization</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sendStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">401</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">verify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">headers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">authorization</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">secret</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter literal-property property" style="color:#36acaa">err</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> any</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> </span><span class="token parameter literal-property property" style="color:#36acaa">jwtContent</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> any</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sendStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">401</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">user</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jwtContent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-supertest-for-integrationapi-testing">5. Supertest for integration/API testing<a class="hash-link" href="#5-supertest-for-integrationapi-testing" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> When testing against an API (i.e., component, integration, E2E tests), the library <a href="https://www.npmjs.com/package/supertest" target="_blank" rel="noopener noreferrer">supertest</a> provides a sweet syntax that can both detect the web server address, make HTTP call and also assert on the response. Three in one</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"When adding invalid user, then the response is 400"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">done</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> request </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"supertest"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Arrange</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> userToAdd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword nil" style="color:#00009f">undefined</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Act</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/user"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">send</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">userToAdd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Content-Type"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">json</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">400</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> done</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Assert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// We already asserted above â˜ğŸ» as part of the request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ğŸ“Š How popular:</strong> 2,717,744 weekly downloads</p><p><strong>ğŸ¤” Why it might be wrong:</strong> You already have your assertion library (Jest? Chai?), it has a great error highlighting and comparison - you trust it. Why code some tests using another assertion syntax? Not to mention, Supertest's assertion errors are not as descriptive as Jest and Chai. It's also cumbersome to mix HTTP client + assertion library instead of choosing the best for each mission. Speaking of the best, there are more standard, popular, and better-maintained HTTP clients (like fetch, axios and other friends). Need another reason? Supertest might encourage coupling the tests to Express as it offers a constructor that gets an Express object. This constructor infers the API address automatically (useful when using dynamic test ports). This couples the test to the implementation and won't work in the case where you wish to run the same tests against a remote process (the API doesn't live with the tests). My repository <a href="https://github.com/testjavascript/nodejs-integration-tests-best-practices" target="_blank" rel="noopener noreferrer">'Node.js testing best practices'</a> holds examples of how tests can infer the API port and address</p><p><strong>â˜€ï¸ Better alternative:</strong> A popular and standard HTTP client library like Node.js Fetch or Axios. In <a href="https://github.com/practicajs/practica" target="_blank" rel="noopener noreferrer">Practica.js</a> (a Node.js starter that packs many best practices) we use Axios. It allows us to configure a HTTP client that is shared among all the tests: We bake inside a JWT token, headers, and a base URL. Another good pattern that we look at, is making each Microservice generate HTTP client library for its consumers. This brings strong-type experience to the clients, synchronizes the provider-consumer versions and as a bonus - The provider can test itself with the same library that its consumers are using</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"When adding invalid user, then the response is 400 and includes a reason"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">done</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Arrange</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> userToAdd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword nil" style="color:#00009f">undefined</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Act</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> receivedResponse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> axios</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">http://localhost:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">apiPort</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/user</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userToAdd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Assert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// âœ… Assertion happens in a dedicated stage and a dedicated library</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">receivedResponse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toMatchObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">reason</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"no-name"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-fastify-decorate-for-non-requestweb-utilities">6. Fastify decorate for non request/web utilities<a class="hash-link" href="#6-fastify-decorate-for-non-requestweb-utilities" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> <a href="https://github.com/fastify/fastify" target="_blank" rel="noopener noreferrer">Fastify</a> introduces great patterns. Personally, I highly appreciate how it preserves the simplicity of Express while bringing more batteries. One thing that got me wondering is the 'decorate' feature which allows placing common utilities/services inside a widely accessible container object. I'm referring here specifically to the case where a cross-cutting concern utility/service is being used. Here is an example:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// An example of a utility that is cross-cutting-concern. Could be logger or anything else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fastify</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">decorate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'metricsService'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">fireMetric</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// My code that sends metrics to the monitoring system</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fastify</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/api/orders'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">request</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> reply</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">metricsService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fireMetric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'new-request'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Handle the request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// my-business-logic.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exports </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">calculateSomething</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// How to fire a metric?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It should be noted that 'decoration' is also used to place values (e.g., user) inside a request - this is a slightly different case and a sensible one</p><p><strong>ğŸ“Š How popular:</strong> Fastify has 696,122 weekly download and growing rapidly. The decorator concept is part of the framework's core</p><p><strong>ğŸ¤” Why it might be wrong:</strong> Some services and utilities serve cross-cutting-concern needs and should be accessible from other layers like domain (i.e, business logic, DAL). When placing utilities inside this object, the Fastify object might not be accessible to these layers. You probably don't want to couple your web framework with your business logic: Consider that some of your business logic and repositories might get invoked from non-REST clients like CRON, MQ, and similar - In these cases, Fastify won't get involved at all so better not trust it to be your service locator</p><p><strong>â˜€ï¸ Better alternative:</strong> A good old Node.js module is a standard way to expose and consume functionality. Need a singleton? Use the module system caching. Need to instantiate a service in correlation with a Fastify life-cycle hook (e.g., DB connection on start)? Call it from that Fastify hook. In the rare case where a highly dynamic and complex instantiation of dependencies is needed - DI is also a (complex) option to consider</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// âœ… A simple usage of good old Node.js modules</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// metrics-service.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exports </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fireMetric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// My code that sends metrics to the monitoring system</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports">fireMetric</span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./metrics-service.js'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fastify</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/api/orders'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">request</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> reply</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  metricsService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fireMetric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'new-request'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// my-business-logic.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exports </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">calculateSomething</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  metricsService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fireMetric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'new-request'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-logging-from-a-catch-clause">7. Logging from a catch clause<a class="hash-link" href="#7-logging-from-a-catch-clause" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> You catch an error somewhere deep in the code (not on the route level), then call logger.error to make this error observable. Seems simple and necessary</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    axios</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">'https</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">thatService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">io</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">api</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">operation</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> addNewOrder</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ğŸ“Š How popular:</strong> Hard to put my hands on numbers but it's quite popular, right?</p><p><strong>ğŸ¤” Why it might be wrong:</strong> First, errors should get handled/logged in a central location. Error handling is a critical path. Various catch clauses are likely to behave differently without a centralized and unified behavior. For example, a request might arise to tag all errors with certain metadata, or on top of logging, to also fire a monitoring metric. Applying these requirements in ~100 locations is not a walk in the park. Second, catch clauses should be minimized to particular scenarios. By default, the natural flow of an error is bubbling down to the route/entry-point - from there, it will get forwarded to the error handler. Catch clauses are more verbose and error-prone - therefore it should serve two very specific needs: When one wishes to change the flow based on the error or enrich the error with more information (which is not the case in this example)</p><p><strong>â˜€ï¸ Better alternative:</strong> By default, let the error bubble down the layers and get caught by the entry-point global catch (e.g., Express error middleware). In cases when the error should trigger a different flow (e.g., retry) or there is value in enriching the error with more context - use a catch clause. In this case, ensure the .catch code also reports to the error handler</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// A case where we wish to retry upon failure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    axios</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">'https</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">thatService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">io</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">api</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// âœ… A central location that handles error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    errorHandler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">handle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">operation</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> addNewOrder</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">callTheUserService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">numOfRetries</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-use-morgan-logger-for-express-web-requests">8. Use Morgan logger for express web requests<a class="hash-link" href="#8-use-morgan-logger-for-express-web-requests" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> In many web apps, you are likely to find a pattern that is being copy-pasted for ages - Using Morgan logger to log requests information:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> express </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"express"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> morgan </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"morgan"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">morgan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"combined"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ğŸ“Š How popular:</strong> 2,901,574 downloads/week</p><p><strong>ğŸ¤” Why it might be wrong:</strong> Wait a second, you already have your main logger, right? Is it Pino? Winston? Something else? Great. Why deal with and configure yet another logger? I do appreciate the HTTP domain-specific language (DSL) of Morgan. The syntax is sweet! But does it justify having two loggers?</p><p><strong>â˜€ï¸ Better alternative:</strong> Put your chosen logger in a middleware and log the desired request/response properties:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// âœ… Use your preferred logger for all the tasks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> logger </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"pino"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> next</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"finish"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">req</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">url</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c"> </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">res</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">statusCode</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Add other properties here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="9-having-conditional-code-based-on-node_env-value">9. Having conditional code based on <code>NODE_ENV</code> value<a class="hash-link" href="#9-having-conditional-code-based-on-node_env-value" title="Direct link to heading">â€‹</a></h2><p><strong>ğŸ’â€â™‚ï¸ What is it about:</strong> To differentiate between development vs production configuration, it's common to set the environment variable NODE_ENV with "production|test". Doing so allows the various tooling to act differently. For example, some templating engines will cache compiled templates only in production. Beyond tooling, custom applications use this to specify behaviours that are unique to the development or production environment:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">NODE_ENV</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"production"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// This is unlikely to be tested since test runner usually set NODE_ENV=test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setLogger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">stdout</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">prettyPrint</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// If this code branch above exists, why not add more production-only configurations:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">collectMetrics</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setLogger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">splunk</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">prettyPrint</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ğŸ“Š How popular:</strong> 5,034,323 code results in GitHub when searching for "NODE_ENV". It doesn't seem like a rare pattern</p><p><strong>ğŸ¤” Why it might be wrong:</strong> Anytime your code checks whether it's production or not, this branch won't get hit by default in some test runner (e.g., Jest set <code>NODE_ENV=test</code>). In <em>any</em> test runner, the developer must remember to test for each possible value of this environment variable. In the example above, <code>collectMetrics()</code> will be tested for the first time in production. Sad smiley. Additionally, putting these conditions opens the door to add more differences between production and the developer machine - when this variable and conditions exists, a developer gets tempted to put some logic for production only. Theoretically, this can be tested: one can set <code>NODE_ENV = "production"</code> in testing and cover the production branches (if she remembers...). But then, if you can test with <code>NODE_ENV='production'</code>, what's the point in separating? Just consider everything to be 'production' and avoid this error-prone mental load</p><p><strong>â˜€ï¸ Better alternative:</strong> Any code that was written by us, must be tested. This implies avoiding any form of if(production)/else(development) conditions. Wouldn't anyway developers machine have different surrounding infrastructure than production (e.g., logging system)? They do, the environments are quite difference, but we feel comfortable with it. These infrastructural things are battle-tested, extraneous, and not part of our code. To keep the same code between dev/prod and still use different infrastructure - we put different values in the configuration (not in the code). For example, a typical logger emits JSON in production but in a development machine it emits 'pretty-print' colorful lines. To meet this, we set ENV VAR that tells whether what logging style we aim for:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//package.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string-property property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"start"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"LOG_PRETTY_PRINT=false index.js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"test"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"LOG_PRETTY_PRINT=true jest"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//index.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//âœ… No condition, same code for all the environments. The variations are defined externally in config or deployment files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setLogger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">prettyPrint</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LOG_PRETTY_PRINT</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="closing">Closing<a class="hash-link" href="#closing" title="Direct link to heading">â€‹</a></h2><p>I hope that these thoughts, at least one of them, made you re-consider adding a new technique to your toolbox. In any case, let's keep our community vibrant, disruptive and kind. Respectful discussions are almost as important as the event loop. Almost.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="some-of-my-other-articles">Some of my other articles<a class="hash-link" href="#some-of-my-other-articles" title="Direct link to heading">â€‹</a></h2><ul><li><a href="https://github.com/testjavascript/nodejs-integration-tests-best-practices" target="_blank" rel="noopener noreferrer">Book: Node.js testing best practices</a></li><li><a href="https://github.com/testjavascript/nodejs-integration-tests-best-practices" target="_blank" rel="noopener noreferrer">Book: JavaScript testing best practices</a></li><li><a href="https://yonigoldberg.medium.com/20-ways-to-become-a-better-node-js-developer-in-2020-d6bd73fcf424" target="_blank" rel="noopener noreferrer">How to be a better Node.js developer in 2020</a>. The 2023 version is coming soon</li><li><a href="https://github.com/practicajs/practica" target="_blank" rel="noopener noreferrer">Practica.js - A Node.js starter</a></li><li><a href="https://github.com/goldbergyoni/nodebestpractices" target="_blank" rel="noopener noreferrer">Node.js best practices</a></li></ul>]]></content>
        <author>
            <name>Yoni Goldberg</name>
            <uri>https://github.com/goldbergyoni</uri>
        </author>
        <category label="node.js" term="node.js"/>
        <category label="express" term="express"/>
        <category label="nestjs" term="nestjs"/>
        <category label="fastify" term="fastify"/>
        <category label="passport" term="passport"/>
        <category label="dotenv" term="dotenv"/>
        <category label="supertest" term="supertest"/>
        <category label="practica" term="practica"/>
        <category label="testing" term="testing"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Practica.js v0.0.1 is alive]]></title>
        <id>practica-is-alive</id>
        <link href="https://practica.dev/blog/practica-is-alive"/>
        <updated>2022-07-15T10:00:00.000Z</updated>
        <summary type="html"><![CDATA[ğŸ¥³ We're thrilled to launch the very first version of Practica.js.]]></summary>
        <content type="html"><![CDATA[<p>ğŸ¥³ We're thrilled to launch the very first version of Practica.js.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-practica-is-one-paragraph">What is Practica is one paragraph<a class="hash-link" href="#what-is-practica-is-one-paragraph" title="Direct link to heading">â€‹</a></h2><p>Although Node.js has great frameworks ğŸ’š, they were never meant to be production ready immediately. Practica.js aims to bridge the gap. Based on your preferred framework, we generate some example code that demonstrates a full workflow, from API to DB, that is packed with good practices. For example, we include a hardened dockerfile, N-Tier folder structure, great testing templates, and more. This saves a great deal of time and can prevent painful mistakes. All decisions made are <a href="/blog/decisions/index">neatly and thoughtfully documented</a>. We strive to keep things as simple and standard as possible and base our work off the popular guide: <a href="https://github.com/goldbergyoni/nodebestpractices" target="_blank" rel="noopener noreferrer">Node.js Best Practices</a>.</p><p>Your developer experience would look as follows: Generate our starter using the CLI and get an example Node.js solution. This solution is a typical Monorepo setup with an example Microservice and libraries. All is based on super-popular libraries that we merely stitch together. It also constitutes tons of optimization - linters, libraries, Monorepo configuration, tests and much more. Inside the example Microservice you'll find an example flow, from API to DB. Based on this, you can modify the entity and DB fields and build you app. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="90-seconds-video">90 seconds video<a class="hash-link" href="#90-seconds-video" title="Direct link to heading">â€‹</a></h2><iframe width="1024" height="768" src="https://www.youtube.com/embed/F6kAs2VEcKw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-get-started">How to get started<a class="hash-link" href="#how-to-get-started" title="Direct link to heading">â€‹</a></h2><p>To get up to speed quickly, read our <a href="https://practica.dev/the-basics/getting-started-quickly" target="_blank" rel="noopener noreferrer">getting started guide</a>.</p>]]></content>
        <author>
            <name>Yoni Goldberg</name>
            <uri>https://github.com/goldbergyoni</uri>
        </author>
        <category label="node.js" term="node.js"/>
        <category label="express" term="express"/>
        <category label="fastify" term="fastify"/>
    </entry>
</feed>